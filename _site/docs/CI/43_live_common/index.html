<!DOCTYPE html>
<html lang="en">

    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Adding MyCoin to Live-Common | Ledger Developer pages</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Adding MyCoin to Live-Common" />
<meta name="author" content="remi_j" />
<meta property="og:locale" content="en" />
<meta name="description" content="Sections in this article" />
<meta property="og:description" content="Sections in this article" />
<link rel="canonical" href="http://localhost:4000/docs/CI/43_live_common/" />
<meta property="og:url" content="http://localhost:4000/docs/CI/43_live_common/" />
<meta property="og:site_name" content="Ledger Developer pages" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-22T15:38:24+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Adding MyCoin to Live-Common" />
<script type="application/ld+json">
{"datePublished":"2021-04-22T15:38:24+02:00","description":"Sections in this article","dateModified":"2021-04-22T15:38:24+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/docs/CI/43_live_common/"},"url":"http://localhost:4000/docs/CI/43_live_common/","author":{"@type":"Person","name":"remi_j"},"@type":"BlogPosting","headline":"Adding MyCoin to Live-Common","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta property="og:image" content="http://localhost:4000/uploads/"/>
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="shortcut icon" type="image/png" href="/uploads/favicon.png" >
  <link rel="alternate" type="application/rss+xml" title="Ledger Developer pages" href="/feed.xml">
  <script src="/assets/js/main.js"></script>
  
    <script>
function searchResults(form) {

    var currentItem = null;
    var search = document.getElementById(form);
    var results = document.getElementById(form + "-results");
    var toggle = document.getElementById(form + "-toggle");

    function removeActive() {
        for (i = 0; i < results.children.length; i++) {
            results.children[i].classList.remove("uk-background-muted");
        }
    }

    // Detect all clicks on the document
    document.addEventListener("click", function(event) {

        var isClickSearch = false;
        var isClickResults = false;
        var isClickSearchToggle = false;

        if (search !== null) {
            isClickSearch = search.contains(event.target);
        }

        if (results !== null) {
            isClickResults = results.contains(event.target);
        }

        if (toggle !== null) {
            isClickSearchToggle = toggle.contains(event.target);
        }

        if (isClickSearch || isClickSearchToggle) {
            results.style.display = "block";
        }        

        if (!isClickResults && !isClickSearch && !isClickSearchToggle) {
            results.style.display = "none";
        }        
        
    });    

    results.addEventListener("mouseover", function(event) {

        removeActive();
        event.target.parentElement.classList.add("uk-background-muted");
        currentItem = null;

    });

    results.addEventListener("mouseout", function(event) {
        event.target.parentElement.classList.remove("uk-background-muted");
    });


    search.addEventListener("keyup", function(event) {

        var resultItems = results.children;
        var resultCount = results.children.length;
                                
        if (event.keyCode === 40) {

            if (currentItem < (resultCount - 1)) {
                if (currentItem === null) {
                    currentItem = 0;
                } else {
                    removeActive();
                    currentItem++;
                }
                removeActive();
                resultItems[currentItem].classList.add("uk-background-muted");
            }
            
        } else if (event.keyCode === 38) {

            if (currentItem > 0) {
                if (currentItem === null) {
                    currentItem = 0;
                } else {
                    removeActive();
                    currentItem--;
                }
                removeActive();
                resultItems[currentItem].classList.add("uk-background-muted");
            }

        } else if (event.keyCode === 13) {

            resultItems[currentItem].children[0].click();

        }

    });

}
</script>
  
  
  
<script src="http://127.0.0.1:35729/livereload.js"></script></head>

    <body>

    
        <div data-uk-sticky="animation: uk-animation-slide-top; sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky; cls-inactive: uk-navbar-transparent; top: 200">
    <nav class="uk-navbar-container">
        <div class="uk-container">
            <div data-uk-navbar>
                <div class="uk-navbar-left">
                    <a class="uk-navbar-item uk-logo uk-visible@m" href="/">Ledger Developer pages</a>
                    
                        <a class="uk-navbar-toggle uk-hidden@m" href="#offcanvas-docs" data-uk-toggle><span data-uk-navbar-toggle-icon></span> <span class="uk-margin-small-left">Docs</span></a>
                    

                    <ul class="uk-navbar-nav uk-visible@m">
                        
                            
                            
                            
                                
                                    
                                        <li><a href="/docs/00_header/" >Creating content</a></li>
                                                                                                        
                                
                            
                        
                            
                            
                            
                                
                                    
                                        <li><a href="/docs/00_header/" >Tools & Frameworks</a></li>
                                                                                                        
                                
                            
                        
                            
                            
                            
                                
                                    
                                        <li><a href="/docs/00_header/" >Release notes</a></li>
                                                                                                        
                                
                            
                        
                            
                            
                            
                                
                                    
                                        <li><a href="/docs/00_header/" >Tutorials</a></li>
                                                                                                        
                                
                            
                        
                            
                            
                            
                                
                                    
                                        <li><a href="#">_Old</a>
                                        
                                            <div class="uk-navbar-dropdown">
                                                <ul class="uk-nav uk-navbar-dropdown-nav">
                                                    
                                                    
                                                        
                                                        
                                                        <li><a href="/docs/TMPL/installation/">Template docs</a></li>
                                                    
                                                    
                                                    
                                                        
                                                        
                                                        <li><a href="/blog/">Blog</a></li>
                                                    
                                                    
                                                    
                                                        <li class="uk-nav-header">Changelogs</li>
                                                    
                                                    
                                                </ul>
                                            </div>
                                        
                                        </li>
                                                                                                        
                                
                            
                        
                    </ul>
                </div>
                <div class="uk-navbar-center uk-hidden@m">
                    <a class="uk-navbar-item uk-logo" href="/">Ledger Developer pages</a>
                </div>
                <div class="uk-navbar-right">
                    
                        
                            <div>
                                <a id="search-navbar-toggle" class="uk-navbar-toggle" uk-search-icon href="#"></a>
                                <div class="uk-drop uk-background-default uk-border-rounded" uk-drop="mode: click; pos: left-center; offset: 0">
                                    <form class="uk-search uk-search-navbar uk-width-1-1" onsubmit="return false;">
                                        <input id="search-navbar" class="uk-search-input" type="search" placeholder="Search for answers" autofocus autocomplete="off">
                                    </form>
                                    <ul id="search-navbar-results" class="uk-position-absolute uk-width-1-1 uk-list"></ul>
                                </div>
                            </div>
                            <script>
                            SimpleJekyllSearch({
                                searchInput: document.getElementById('search-navbar'),
                                resultsContainer: document.getElementById('search-navbar-results'),
                                noResultsText: '<li class="no-results">No results found</li>',
                                searchResultTemplate: '<li><a href="{url}">{title}</a></li>',
                                json: "/search.json"
                            });
                            searchResults("search-navbar");
                            </script>
                        
                    

                    <ul class="uk-navbar-nav uk-visible@m">
                        
                    </ul>

                    
                        <a class="uk-navbar-toggle uk-hidden@m" href="#offcanvas" data-uk-toggle><span data-uk-navbar-toggle-icon></span> <span class="uk-margin-small-left">Menu</span></a>
                    

                </div>
            </div>
        </div>
    </nav>
</div>
    

    <div class="uk-section">
    <div class="uk-container">
        <div class="uk-grid-large" data-uk-grid>

            <div class="sidebar-fixed-width uk-visible@m">
                <div class="sidebar-docs uk-position-fixed uk-margin-top">
                    
                    <h5>Getting Started</h5>
                    <ul class="uk-nav uk-nav-default doc-nav">
                    
                      
                      
                      <li class=""><a href="/docs/CI/10_general_process/">General Process</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/CI/20_modules/">Modules – General Architecture</a></li>
                    
                    </ul>
                    
                    <h5>Prerequisites</h5>
                    <ul class="uk-nav uk-nav-default doc-nav">
                    
                      
                      
                      <li class=""><a href="/docs/CI/30_live_prerequisites/">Prerequisites</a></li>
                    
                    </ul>
                    
                    <h5>Coding</h5>
                    <ul class="uk-nav uk-nav-default doc-nav">
                    
                      
                      
                      <li class=""><a href="/docs/CI/40_live_coin_integration/">Adding *MyCoin* to Ledger Live</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/CI/41_live_cryptoassets/">Adding *MyCoin* to CryptoAssets library</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/CI/42_live_app_bindings/">Adding *MyCoin* Nano App JS Bindings</a></li>
                    
                      
                      
                      <li class="uk-active"><a href="/docs/CI/43_live_common/">Adding *MyCoin* to Live-Common</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/CI/44_live_frontend/">Adding *MyCoin* to Ledger Live Desktop and Mobile</a></li>
                    
                    </ul>
                    
                    <h5>Testing</h5>
                    <ul class="uk-nav uk-nav-default doc-nav">
                    
                      
                      
                      <li class=""><a href="/docs/CI/50_live_tests/">Testing</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/CI/51_live_on_desktop/">Getting your Ledger Live running</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/CI/52_live_install_ios/">Building iOS Dev App</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/CI/53_live_install_android/">Building Android Dev App</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/CI/54_live_run_on_ios_android/">Running iOS and Android Dev Apps</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/CI/55_live_gen_cli/">General CLI Checklist - User tests</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/CI/56_live_spe_cli/">Specific CLI Checklist - User tests</a></li>
                    
                    </ul>
                    
                    <h5>Guidelines</h5>
                    <ul class="uk-nav uk-nav-default doc-nav">
                    
                      
                      
                      <li class=""><a href="/docs/CI/60_live_guidelines/">JavaScript Coding Guidelines</a></li>
                    
                    </ul>
                    
                </div>
            </div>

            <div class="uk-width-1-1 uk-width-expand@m">

                <article class="uk-article">

                    <h1 class="uk-article-title">Adding *MyCoin* to Live-Common</h1>

                    

                    <div class="uk-article-meta uk-margin-top uk-margin-medium-bottom uk-flex uk-flex-middle">
                        


  
  <img class="uk-border-circle avatar" src="http://localhost:4000/uploads/avatar-remi_j.jpg" alt="Remi Jarasson">


<div>
  
    Written by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Remi Jarasson</span></span><br>
  
  <time datetime="" itemprop="datePublished">
    
    
  </time>
</div>
                    </div>

                    <div class="article-content link-primary">
                        <h4 class="no_toc" id="sections-in-this-article">Sections in this article</h4>
<ul id="markdown-toc">
  <li><a href="#mycoin-implementation-in-live-common" id="markdown-toc-mycoin-implementation-in-live-common"><em>MyCoin</em> implementation in Live-Common</a>    <ul>
      <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
      <li><a href="#setup" id="markdown-toc-setup">Setup</a>        <ul>
          <li><a href="#requirements" id="markdown-toc-requirements">Requirements</a></li>
          <li><a href="#development-tools-used-or-required" id="markdown-toc-development-tools-used-or-required">Development tools (used or required)</a></li>
          <li><a href="#hardware-prerequisites" id="markdown-toc-hardware-prerequisites">Hardware prerequisites</a></li>
          <li><a href="#installation" id="markdown-toc-installation">Installation</a></li>
          <li><a href="#cli-setup" id="markdown-toc-cli-setup">CLI setup</a></li>
        </ul>
      </li>
      <li><a href="#structure" id="markdown-toc-structure">Structure</a></li>
      <li><a href="#generating-families-specific-imports" id="markdown-toc-generating-families-specific-imports">Generating families-specific imports</a></li>
      <li><a href="#building-for-development" id="markdown-toc-building-for-development">Building for Development</a>        <ul>
          <li><a href="#environment-variables" id="markdown-toc-environment-variables">Environment Variables</a></li>
          <li><a href="#linking-local-packages" id="markdown-toc-linking-local-packages">Linking local packages</a></li>
        </ul>
      </li>
      <li><a href="#step-by-step-integration" id="markdown-toc-step-by-step-integration">Step by Step integration</a>        <ul>
          <li><a href="#mycoin-cryptoassets" id="markdown-toc-mycoin-cryptoassets">MyCoin cryptoassets</a></li>
          <li><a href="#derive-address-from-device" id="markdown-toc-derive-address-from-device">Derive Address from device</a></li>
          <li><a href="#derivation" id="markdown-toc-derivation">Derivation</a></li>
          <li><a href="#types" id="markdown-toc-types">Types</a>            <ul>
              <li><a href="#semantics" id="markdown-toc-semantics">Semantics</a></li>
              <li><a href="#account" id="markdown-toc-account">Account</a></li>
              <li><a href="#operation" id="markdown-toc-operation">Operation</a></li>
              <li><a href="#operation-type" id="markdown-toc-operation-type">Operation Type</a></li>
              <li><a href="#transaction" id="markdown-toc-transaction">Transaction</a></li>
              <li><a href="#family-specific-types" id="markdown-toc-family-specific-types">Family-specific types</a></li>
              <li><a href="#operation-account-and-transaction-serialization" id="markdown-toc-operation-account-and-transaction-serialization">Operation, Account and Transaction serialization</a></li>
            </ul>
          </li>
          <li><a href="#wrap-your-api" id="markdown-toc-wrap-your-api">Wrap your API</a>            <ul>
              <li><a href="#api-example" id="markdown-toc-api-example">API Example</a></li>
            </ul>
          </li>
          <li><a href="#js-bridge" id="markdown-toc-js-bridge">JS Bridge</a>            <ul>
              <li><a href="#starting-with-a-mock" id="markdown-toc-starting-with-a-mock">Starting with a mock</a></li>
              <li><a href="#split-your-code" id="markdown-toc-split-your-code">Split your code</a></li>
            </ul>
          </li>
          <li><a href="#account-bridge" id="markdown-toc-account-bridge">Account Bridge</a>            <ul>
              <li><a href="#receive" id="markdown-toc-receive">Receive</a></li>
              <li><a href="#synchronization" id="markdown-toc-synchronization">Synchronization</a></li>
              <li><a href="#reconciliation" id="markdown-toc-reconciliation">Reconciliation</a></li>
              <li><a href="#transactions" id="markdown-toc-transactions">Transactions</a></li>
              <li><a href="#validating-transactions" id="markdown-toc-validating-transactions">Validating Transactions</a></li>
              <li><a href="#dealing-with-logic-and-errors" id="markdown-toc-dealing-with-logic-and-errors">Dealing with Logic and Errors</a></li>
              <li><a href="#building-and-signing-transaction" id="markdown-toc-building-and-signing-transaction">Building and Signing transaction</a></li>
              <li><a href="#broadcast" id="markdown-toc-broadcast">Broadcast</a></li>
              <li><a href="#estimate-max-spendable" id="markdown-toc-estimate-max-spendable">Estimate Max Spendable</a></li>
              <li><a href="#testing-send-with-cli" id="markdown-toc-testing-send-with-cli">Testing send with CLI</a></li>
            </ul>
          </li>
          <li><a href="#currency-bridge" id="markdown-toc-currency-bridge">Currency Bridge</a>            <ul>
              <li><a href="#scanning-accounts" id="markdown-toc-scanning-accounts">Scanning accounts</a></li>
              <li><a href="#preload-currency-data-optional" id="markdown-toc-preload-currency-data-optional">Preload currency data (optional)</a></li>
            </ul>
          </li>
          <li><a href="#cache-and-performance" id="markdown-toc-cache-and-performance">Cache and performance</a></li>
          <li><a href="#front-end-helpers" id="markdown-toc-front-end-helpers">Front-End helpers</a>            <ul>
              <li><a href="#device-transaction-fields" id="markdown-toc-device-transaction-fields">Device transaction fields</a></li>
            </ul>
          </li>
          <li><a href="#react-hooks-optional--advanced" id="markdown-toc-react-hooks-optional--advanced">React hooks (optional / advanced)</a></li>
          <li><a href="#icon" id="markdown-toc-icon">Icon</a></li>
        </ul>
      </li>
      <li><a href="#testing" id="markdown-toc-testing">Testing</a></li>
    </ul>
  </li>
</ul>

<h1 id="mycoin-implementation-in-live-common"><em>MyCoin</em> implementation in Live-Common</h1>

<!--

- [_MyCoin_ implementation in Live-Common](#mycoin-implementation-in-live-common)
  - [Introduction](#introduction)
  - [Setup](#setup)
    - [Requirements](#requirements)
    - [Development tools (used or required)](#development-tools-used-or-required)
    - [Hardware prerequisites](#hardware-prerequisites)
    - [Installation](#installation)
    - [CLI setup](#cli-setup)
  - [Structure](#structure)
  - [Generating families-specific imports](#generating-families-specific-imports)
  - [Building for Development](#building-for-development)
    - [Environment Variables](#environment-variables)
    - [Linking local packages](#linking-local-packages)
  - [Step by Step integration](#step-by-step-integration)
    - [MyCoin cryptoassets](#mycoin-cryptoassets)
    - [Derive Address from device](#derive-address-from-device)
    - [Derivation](#derivation)
    - [Types](#types)
      - [Semantics](#semantics)
      - [Account](#account)
      - [Operation](#operation)
      - [Operation Type](#operation-type)
      - [Transaction](#transaction)
      - [Family-specific types](#family-specific-types)
      - [Operation, Account and Transaction serialization](#operation-account-and-transaction-serialization)
    - [Wrap your API](#wrap-your-api)
      - [API Example](#api-example)
    - [JS Bridge](#js-bridge)
      - [Starting with a mock](#starting-with-a-mock)
      - [Split your code](#split-your-code)
    - [Account Bridge](#account-bridge)
      - [Receive](#receive)
      - [Synchronization](#synchronization)
      - [Reconciliation](#reconciliation)
      - [Transactions](#transactions)
      - [Validating Transactions](#validating-transactions)
      - [Dealing with Logic and Errors](#dealing-with-logic-and-errors)
      - [Building and Signing transaction](#building-and-signing-transaction)
      - [Broadcast](#broadcast)
      - [Estimate Max Spendable](#estimate-max-spendable)
      - [Testing send with CLI](#testing-send-with-cli)
    - [Currency Bridge](#currency-bridge)
      - [Scanning accounts](#scanning-accounts)
      - [Preload currency data (optional)](#preload-currency-data-optional)
    - [Cache and performance](#cache-and-performance)
    - [Front-End helpers](#front-end-helpers)
      - [Device transaction fields](#device-transaction-fields)
    - [React hooks (optional / advanced)](#react-hooks-optional--advanced)
    - [Icon](#icon)
  - [Testing](#testing)

-->

<hr />

<h2 id="introduction">Introduction</h2>

<p>Ledger Live Common is the shared core library used by Ledger Live Desktop and Mobile, that also includes a CLI for testing purpose or for using Ledger Live features directly from a terminal (in a limited way).</p>

<p>This library is built upon a pretty standard ES6 + FlowType stack and relies on a bunch of <a href="https://github.com/LedgerHQ/ledgerjs">ledgerjs</a> packages, <a href="https://github.com/ReactiveX/rxjs/tree/6.x">RxJS 6.x</a>, <a href="https://github.com/MikeMcl/bignumber.js">bignumber.js</a> and <a href="https://github.com/facebook/react/">React</a> + <a href="https://github.com/reduxjs/redux">Redux</a> for some front-end utilities and hooks.</p>

<p>It is designed to have very generic models and mechanics (for currencies, accounts, storage, synchronisation, events…) that also facilitates new coin integrations through flexibility.
All integrated coins are implemented in a <code class="language-plaintext highlighter-rouge">src/families</code> dedicated folder which contains the specifics of a coin family - that can be shared by multiple crypto-assets that use the same implementation (i.e. Bitcoin-like coins share the same <code class="language-plaintext highlighter-rouge">bitcoin</code> family).</p>

<p>Some of those families are implemented using the Ledger’s <a href="https://github.com/LedgerHQ/lib-ledger-core">libcore</a> which is a monolithic library built in C++ that we tend to replace by JS implementations.</p>

<p><strong>This document only concerns new coin integrations using JavaScript - we will use an imaginary coin named <code class="language-plaintext highlighter-rouge">MyCoin</code> as a walkthrough.</strong></p>

<h2 id="setup">Setup</h2>

<h3 id="requirements">Requirements</h3>

<ul>
  <li><a href="https://nodejs.org/">NodeJS LTS/Erbium (Node 12.x)</a></li>
  <li><a href="https://classic.yarnpkg.com/lang/en/">Yarn</a> 1.x (Classic)</li>
  <li>Python 2.7 or 3.5+</li>
  <li>A C/C++ toolchain (see node-gyp documentation)</li>
</ul>

<h3 id="development-tools-used-or-required">Development tools (used or required)</h3>

<ul>
  <li><a href="https://github.com/wclr/yalc">yalc</a> for locally linking live-common with other projects</li>
  <li><a href="https://github.com/eslint/eslint">eslint</a> - ensure it’s working in your IDE (<a href="https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint">vscode plugin</a>)</li>
  <li><a href="https://github.com/prettier/prettier">prettier</a> - through an eslint-plugin</li>
  <li><a href="https://flow.org/">flowtype</a> - ensure it works fine with your IDE (<a href="https://marketplace.visualstudio.com/items?itemName=flowtype.flow-for-vscode">vscode plugin</a>)</li>
</ul>

<h3 id="hardware-prerequisites">Hardware prerequisites</h3>

<ul>
  <li>A physical device (Ledger Nano S or Ledger Nano X)</li>
  <li>MyCoin app installed on device</li>
</ul>

<h3 id="installation">Installation</h3>

<ul>
  <li>Clone project <a href="https://github.com/LedgerHQ/ledger-live-common">https://github.com/LedgerHQ/ledger-live-common</a></li>
  <li><code class="language-plaintext highlighter-rouge">yarn install</code> will install all dependencies</li>
  <li><code class="language-plaintext highlighter-rouge">yalc publish --push</code> will build and link live-common</li>
</ul>

<h3 id="cli-setup">CLI setup</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>cli/
yalc add @ledgerhq/live-common
yarn <span class="nb">install
</span>yarn <span class="nb">link</span>        <span class="c"># will make ledger-live CLI available</span>
</code></pre></div></div>

<p>You can test that your local Live Common and your device works correctly by executing a CLI command like:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ledger-live version      <span class="c"># should print live-common version</span>
ledger-live deviceInfo   <span class="c"># should display information about connected device</span>
</code></pre></div></div>

<p><em>Note: ensure <code class="language-plaintext highlighter-rouge">yarn global bin</code> is in your $PATH. You can build automatically the CLI by running <code class="language-plaintext highlighter-rouge">yarn watch</code> in a separate terminal to ensure <code class="language-plaintext highlighter-rouge">ledger-live</code> bin is always up-to-date with your work.</em></p>

<p>If everything is fine, you are ready to start integrating your new coin <code class="language-plaintext highlighter-rouge">MyCoin</code> !</p>

<h2 id="structure">Structure</h2>

<p>Your whole implementation of <code class="language-plaintext highlighter-rouge">MyCoin</code> must reside in a <code class="language-plaintext highlighter-rouge">mycoin</code> folder in <code class="language-plaintext highlighter-rouge">src/families/</code>, with the exception of some changes to apply in shared code.</p>

<p>Here is a typical family folder structure (JS integration):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./src/families/mycoin
├── bridge
│   └── js.js
├── hw-app-mycoin
│   └── MyCoin.js
├── api.js
├── hw-getAddress.js
├── errors.js
├── deviceTransactionConfig.js
├── account.js
├── transaction.js
├── serialization.js
├── cli-transaction.js
├── logic.js
├── cache.js
├── preload.js
├── react.js
├── specs.js
├── speculos-deviceActions.js
├── test-dataset.js
├── test-specifics.js
└── types.js
</code></pre></div></div>

<p><em>Note: You can refer to existing implementations to complete given examples, like <a href="https://github.com/Ledger-Coin-Integration-team/ledger-live-common/src/families/polkadot">Polkadot integration</a></em></p>

<p>In the section Below, the files are marked as <strong>Required</strong>, <strong>Recommended</strong>, or <strong>Optional</strong> accordingly.</p>

<h2 id="generating-families-specific-imports">Generating families-specific imports</h2>

<p>All per-family imports are gathered in the <a href="https://github.com/LedgerHQ/ledger-live-common/tree/master/src/generated"><code class="language-plaintext highlighter-rouge">src/generated</code></a> folder, for letting generic code to choose which implementation to use on a per-coin basis.</p>

<p>You should not update those files manually, but call a dedicated script:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./scripts/sync-families-dispatch.sh
</code></pre></div></div>

<p><em>NOTE: you may need to add <code class="language-plaintext highlighter-rouge">mycoin</code> to the <code class="language-plaintext highlighter-rouge">withoutNetworkInfo</code> in this script if you don’t use a NetworkInfo type.</em></p>

<p><strong>As soon as you add a file in the family (that is part of the generated folder) you will need to execute this script before building.</strong> Otherwise, your implementation will not be known by the live-common library.</p>

<h2 id="building-for-development">Building for Development</h2>

<p>Do not forget to build before testing:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yalc publish --push
# if not yarn watch
cd cli
yarn build
</code></pre></div></div>

<h3 id="environment-variables">Environment Variables</h3>

<p>Ledger Live provides a lot of flexibility through ENV variables. You can export them, define them before calling cli or use a tool like <a href="https://direnv.net/">direnv</a>.</p>

<p>To list them all, you can execute:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ledger-live envs
</code></pre></div></div>

<p>The one you will use the most before releasing you integration is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>EXPERIMENTAL_CURRENCIES=mycoin
</code></pre></div></div>

<p>It will consider <code class="language-plaintext highlighter-rouge">mycoin</code> as supported (you can also add it to the supported currencies in <code class="language-plaintext highlighter-rouge">cli/src/live-common-setup-base.js</code>).</p>

<p><strong>For clarity, we will omit this environment variable in this document.</strong></p>

<p>If needed, you can add your own in <code class="language-plaintext highlighter-rouge">src/env.js</code> (always try to add a MYCOIN_ prefix to avoid collisions):</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// const envDefinitions = { ...</span>
  <span class="nx">MYCOIN_API_ENDPOINT</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">def</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://mycoin.coin.ledger.com</span><span class="dl">"</span><span class="p">,</span>
    <span class="nx">parser</span><span class="p">:</span> <span class="nx">stringParser</span><span class="p">,</span>
    <span class="nx">desc</span><span class="p">:</span> <span class="dl">"</span><span class="s2">API for mycoin</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">},</span>
<span class="c1">// }</span>
</code></pre></div></div>

<h3 id="linking-local-packages">Linking local packages</h3>

<p>You may need to override some package with a local version (like <code class="language-plaintext highlighter-rouge">@ledgerhq/cryptoassets</code> or <code class="language-plaintext highlighter-rouge">@ledgerhq/hw-app-mycoin</code>). Use <code class="language-plaintext highlighter-rouge">yalc add package-name</code> to do so.</p>

<p>Since your build would be used locally during developemnt, you may also want those dependencies to be local and included in the published local package.
Ensure the <code class="language-plaintext highlighter-rouge">.yalc</code> directory is included then in the package.json:</p>

<p><code class="language-plaintext highlighter-rouge">package.json</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  "files": [
    ...,
    ".yalc"
  ],
</code></pre></div></div>

<p><em><strong>WARNING: Do not commit changes due to the usage of <code class="language-plaintext highlighter-rouge">yalc</code> as it may result in wrong behaviour.</strong></em></p>

<h2 id="step-by-step-integration">Step by Step integration</h2>

<h3 id="mycoin-cryptoassets">MyCoin cryptoassets</h3>

<p>We will consider that <em>MyCoin</em> is already in <a href="https://github.com/LedgerHQ/ledgerjs/tree/master/packages/cryptoassets">@ledgerhq/cryptoassets</a> package. If not, see <a href="41_live_cryptoassets.md"><em>MyCoin</em> in CryptoAssets</a>.</p>

<h3 id="derive-address-from-device">Derive Address from device</h3>

<p>If your app JS bindings (see See <a href="42_live_app_bindings.md"><em>My Coin</em> App JS Bindings</a>) are not yet published in <a href="https://github.com/LedgerHQ/ledgerjs">LedgerJS</a>, you can put them in <code class="language-plaintext highlighter-rouge">src/families/mycoin/hw-app-mycoin</code>.</p>

<p>First and easiest step is to get an address from the device for MyCoin, by creating the <code class="language-plaintext highlighter-rouge">hw-getAddress.js</code> Resolver:</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/hw-getAddress.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>

<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Resolver</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../hw/getAddress/types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">MyCoin</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./hw-app-mycoin/MyCoin</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">resolver</span><span class="p">:</span> <span class="nx">Resolver</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">transport</span><span class="p">,</span> <span class="p">{</span> <span class="nx">path</span><span class="p">,</span> <span class="nx">verify</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">myCoin</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCoin</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">myCoin</span><span class="p">.</span><span class="nx">getAddress</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">verify</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">address</span><span class="p">:</span> <span class="nx">r</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span>
    <span class="na">publicKey</span><span class="p">:</span> <span class="nx">r</span><span class="p">.</span><span class="nx">publicKey</span><span class="p">,</span>
    <span class="nx">path</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">resolver</span><span class="p">;</span>
</code></pre></div></div>

<p>Test that you can derive an address:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ledger-live getAddress --currency mycoin --path "44'/8008'/0'/0/0" --derivationMode ""
</code></pre></div></div>

<h3 id="derivation">Derivation</h3>

<p>Ledger Live uses the BIP44 derivation mode by default (as <code class="language-plaintext highlighter-rouge">derivationMode=""</code>), which is standard and most common way for HD wallet.
If <em>MyCoin</em> has a conventional derivation path (BIP44), Ledger Live should already be able to derive an address correctly.</p>

<p><strong>If you need to use another derivation mode:</strong></p>

<p>Make changes to <a href="https://github.com/LedgerHQ/ledger-live-common/tree/master/src/derivation.js"><code class="language-plaintext highlighter-rouge">src/derivation.js</code></a>:</p>

<ol>
  <li>Add a new derivation mode with <code class="language-plaintext highlighter-rouge">overridesDerivation</code>:</li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// const modes = Object.freeze({</span>
<span class="c1">// ...</span>
  <span class="nx">mycoinbip44h</span><span class="p">:</span> <span class="p">{</span> <span class="c1">// Hardened BIP44 for MyCoin</span>
    <span class="nl">overridesDerivation</span><span class="p">:</span> <span class="dl">"</span><span class="s2">44'/8008'/&lt;account&gt;'/0'/&lt;address&gt;'</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">},</span>
<span class="c1">// });</span>
</code></pre></div></div>

<ol>
  <li>add the mode to family in <code class="language-plaintext highlighter-rouge">legacyDerivations</code>:</li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// const legacyDerivations: $Shape&lt;CryptoCurrencyConfig&lt;DerivationMode[]&gt;&gt; = {</span>
<span class="c1">// ...</span>
  <span class="nx">mycoin</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">mycoinbip44h</span><span class="dl">"</span><span class="p">],</span>
<span class="c1">// };</span>
</code></pre></div></div>

<ol>
  <li>disable the default use of BIP44 in <code class="language-plaintext highlighter-rouge">disableBIP44</code>:</li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// const disableBIP44 = {</span>
<span class="c1">// ...</span>
  <span class="nx">mycoin</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="c1">// };</span>
</code></pre></div></div>

<p>See <a href="https://github.com/LedgerHQ/ledger-live-common/blob/master/docs/derivation.md">Derivation documentation</a> for further details.</p>

<p>You can check that the derivationMode is correct by executing:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ledger-live derivation <span class="nt">--currency</span> mycoin

<span class="c">#&gt;  default: MyCoin 1: 44'/8008'/&lt;account&gt;'/&lt;change&gt;/&lt;address&gt;</span>
</code></pre></div></div>

<h3 id="types">Types</h3>

<p>Generic types can be found in <a href="https://github.com/Ledger-Coin-Integration-team/ledger-live-common/blob/master/src/types">src/types/</a>, with some documentation in source.</p>

<h4 id="semantics">Semantics</h4>

<blockquote>
  <p><strong>Semantic: What is an Account?</strong></p>
</blockquote>

<p>An account represents a wallet where a user detains crypto assets for a given crypto currency.</p>

<p>Ledger Live model is essentially an array of <code class="language-plaintext highlighter-rouge">Account</code> because many accounts can be created, even within a same crypto currency.</p>

<p>More technically, an account is a view of the blockchain in the context of a specific user. While blockchain tracks the series of transactions, assets motions that happen between addresses, an account essentializes that from the point of view of a user that owns a set of addresses and wants to view the associated funds they detain and be able to perform transactions with it.</p>

<p>Essentially what the user wants to see at the end is his balance, a historic graph, and a series of past operations that were performed. Moving from the blockchain to the concept of account is not necessarily trivial (in blockchains like Bitcoin, the concept of account does not exist – you don’t create or destroy, this concept is a view, a lense, that we abstract for the user).</p>

<blockquote>
  <p><strong>Semantic: What is an Operation?</strong></p>
</blockquote>

<p>Note the wording “Operation” is used instead of “Transaction”. An account does not have transactions, it has <strong>operations</strong>.</p>

<p>The same abstraction applies as for Account on top of blockchain: an Operation is a view of a transaction that happened in the blockchain that <strong>concerns</strong> the contextual account. It’s always in the context of an account, in other words, an operation does not exist on its own.</p>

<p>Most of the time, a transaction yield of one operation. But in some blockchains (like Ethereum) one transaction that concerns the account associated addresses can result in 0 to N operations. A typical example is contract or token transfers (one transaction to move a token generate a token operation and a fee operation in the ethereum account). Another example that is possible in most blockchains is a “self” transaction yields two operations (sending out, sending in). But in fact, that’s semantic, we, Ledger, have put. We could also have allowed the concept of “SELF” operation.</p>

<blockquote>
  <p><strong>Semantic: What is a Transaction?</strong></p>
</blockquote>

<p>In Ledger Live, the “Transaction” is the data model that is created and updated in order to build the final blob to be signed by the device, and then broadcasted to the blockchain.</p>

<p>It is highly specific to the blockchain protocol, and contains any data that will need to be serialized into the transmission format of the blockchain. It only lives for a short period of time in the application - during which the user is choosing the parameters of its transaction before it is signed and sent to the blockchain, after which it will be transformed into an Operation.</p>

<p>Note that this Operation will be considered “pending”, as it is an optimistic version of the real Operation that will appear in the account history, after being synchronized.</p>

<h4 id="account">Account</h4>

<p>In Live Common, there are currently 3 types of accounts:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Account</code> which is a top level account associated to a <code class="language-plaintext highlighter-rouge">CryptoCurrency</code> - the “main” account.</li>
  <li><code class="language-plaintext highlighter-rouge">TokenAccount</code> which is a nested level account, <strong>inside</strong> an Account and that is associated to a <code class="language-plaintext highlighter-rouge">TokenCurrency</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">ChildAccount</code> which is a variant of TokenAccount but more in context of a <code class="language-plaintext highlighter-rouge">CryptoCurrency</code> (typically used for Tezos)</li>
</ul>

<p>They are aggregated as a single <code class="language-plaintext highlighter-rouge">AccountLike</code> type, used across Ledger Live implementations.</p>

<p>We will focus only on the <code class="language-plaintext highlighter-rouge">Account</code> type as we won’t cover the Token integration in this document.</p>

<p>All main accounts share a common ground:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">id: string</code>: a unique account identifier we build up with many pieces of information. It’s generally composed of 5 parts split by a <code class="language-plaintext highlighter-rouge">:</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">seedIdentifier: string</code>: a unique way to identify a seed the account was associated with.</li>
  <li><code class="language-plaintext highlighter-rouge">xpub?: string</code>: the xpub if relevant. This information is redundant with the <code class="language-plaintext highlighter-rouge">id</code> and might be eventually dropped.</li>
  <li><code class="language-plaintext highlighter-rouge">derivationMode: DerivationMode</code> identifies the derivation scheme that is used. See <a href="#derivation">Derivation</a>.</li>
  <li><code class="language-plaintext highlighter-rouge">index: number</code>: the index of the account among a given <code class="language-plaintext highlighter-rouge">derivationMode</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">freshAddress: string</code>: the “next” public address where a user should receive funds. For account-based blockchains, it is the current public address.</li>
  <li><code class="language-plaintext highlighter-rouge">freshAddressPath: string</code> represents the derivation path where the <code class="language-plaintext highlighter-rouge">freshAddress</code> was taken from.</li>
  <li><code class="language-plaintext highlighter-rouge">freshAddresses: Address[]</code>: an array of “future” fresh addresses. It is a generalisation of <code class="language-plaintext highlighter-rouge">freshAddress</code> and <code class="language-plaintext highlighter-rouge">freshAddressPath</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">name: string</code>: name of the account that the user has set. It is not saved or restored from any place but is defined by the user and locally saved.</li>
  <li><code class="language-plaintext highlighter-rouge">balance: BigNumber</code> represent the total amount of assets that this account holds.</li>
  <li><code class="language-plaintext highlighter-rouge">spendableBalance: BigNumber</code>: represents the subset of <code class="language-plaintext highlighter-rouge">balance</code> that can be spent. Most of the time it will be equal to <code class="language-plaintext highlighter-rouge">balance</code> but this can vary in some blockchains.</li>
  <li><code class="language-plaintext highlighter-rouge">blockHeight: number</code>: tracks the current blockchain block height.</li>
  <li><code class="language-plaintext highlighter-rouge">currency: CryptoCurrency</code>: the associated crypto currency of the Account. See <a href="41_live_cryptoassets.md"><em>MyCoin</em> in CryptoAssets</a></li>
  <li><code class="language-plaintext highlighter-rouge">unit: Unit</code>: the user defined preferred unit to view the account with. It’s initialized to <code class="language-plaintext highlighter-rouge">currency.units[0]</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">operationsCount: number</code> gives the total number of operations this account contains. This field exists because the <code class="language-plaintext highlighter-rouge">operations</code> array is not guaranteed to be complete.</li>
  <li><code class="language-plaintext highlighter-rouge">operations: Operation[]</code>: an array of operations sorted from the most recent to the oldest one. It might be partial, containing only the last N operations but can be paginated on.</li>
  <li><code class="language-plaintext highlighter-rouge">pendingOperations: Operation[]</code>: like <code class="language-plaintext highlighter-rouge">operations</code> but only for <em>optimistic updates</em> of operations resulting from transactions that were just performed and not yet confirmed.</li>
  <li><code class="language-plaintext highlighter-rouge">lastSyncDate: Date</code>: the date of the last time a synchronisation was performed.</li>
  <li><code class="language-plaintext highlighter-rouge">subAccounts?: SubAccount[]</code>: an optional field that is defined for accounts that can contain children accounts. This is for instance used for tokens and Tezos originated accounts.</li>
  <li><code class="language-plaintext highlighter-rouge">balanceHistory?: BalanceHistoryMap</code>: a cache that contains the historical datapoints of the balance in different ranges of time. It might not be present in Account and in that case, a fallback JS implementation will be used to calculate this from the operations array.</li>
</ul>

<p>But if needed by the blockchain, an account can also contain coin-specific resources related to a single account, like its “nonce” or additional balances (e.g. for staking), or anything that may be displayed or used in your implementation. It’s generally an additional field like <code class="language-plaintext highlighter-rouge">myCoinResources</code>. See <a href="#family-specific-types">Family-specific types</a> below.</p>

<p>For further details, see <a href="https://github.com/LedgerHQ/ledger-live-common/blob/master/docs/account.md">Account documentation</a> and <a href="https://github.com/Ledger-Coin-Integration-team/ledger-live-common/blob/master/src/types/account.js">src/types/account.js</a></p>

<h4 id="operation">Operation</h4>

<p>In short, transactions history in Ledger Live is a list of <code class="language-plaintext highlighter-rouge">Operation</code>, that are confirmed, unconfirmed or pending (not yet fetched from explorer).</p>

<p>They all share the same model, with an <code class="language-plaintext highlighter-rouge">extra</code> field that can store any additional data you may need to display:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">id: string</code>: unique identifier (encoded as <code class="language-plaintext highlighter-rouge">accountId-hash-TYPE</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">hash: string</code>: transaction hash from blockchain</li>
  <li><code class="language-plaintext highlighter-rouge">type: OperationType</code>: see <a href="#operation-type">Operation Type</a> below</li>
  <li><code class="language-plaintext highlighter-rouge">value: BigNumber</code>: atomic value of the operation, as <em>a positive value</em> that affects the account balance (includes fees for OUT, not for IN, only fees for FEES…)</li>
  <li><code class="language-plaintext highlighter-rouge">fee: BigNumber</code>: atomic value of the operation fees (no matter which direction)</li>
  <li><code class="language-plaintext highlighter-rouge">senders: string[]</code>: list of senders addresses</li>
  <li><code class="language-plaintext highlighter-rouge">recipients: string[]</code>: list of recipients addresses</li>
  <li><code class="language-plaintext highlighter-rouge">blockHeight?: number</code>: (optional) height of the block on the blockchain</li>
  <li><code class="language-plaintext highlighter-rouge">blockHash?: string</code>: (optional) hash of the block the operation is in</li>
  <li><code class="language-plaintext highlighter-rouge">transactionSequenceNumber?: number</code>: sequence number of the transaction in blockchains (aka “nonce”)</li>
  <li><code class="language-plaintext highlighter-rouge">accountId: string</code>: the Ledger Live account id</li>
  <li><code class="language-plaintext highlighter-rouge">date: Date</code>: parsed transaction date</li>
  <li><code class="language-plaintext highlighter-rouge">hasFailed?: boolean</code>: does the transaction succeeded</li>
  <li><code class="language-plaintext highlighter-rouge">subOperations?: Operation[]</code>: (advanced) in context of accounts that can have tokens, an operation can contains itself operations</li>
  <li><code class="language-plaintext highlighter-rouge">internalOperations?: Operation[]</code>: (advanced) in context of accounts that have internal transactions that belong to a parent transaction</li>
  <li><code class="language-plaintext highlighter-rouge">extra: Object</code>: Extra crypto specific fields</li>
</ul>

<p>If <em>MyCoin</em> has specific operation fields (like <code class="language-plaintext highlighter-rouge">additionalField</code> we added for example), you will be able to display them later. They are not meant to be useful in any flow, only for UI.</p>

<p>If <em>MyCoin</em> uses a “nonce”, then <code class="language-plaintext highlighter-rouge">transactionSequenceNumber</code> must be filled correctly, as it will be necessary for signing new transactions (and will interpreted to clear pending operations). Only outgoing transaction must have this value though. See <a href="#optimistic-operation">Optimistic Operation</a>.</p>

<p>See <a href="https://github.com/Ledger-Coin-Integration-team/ledger-live-common/blob/master/src/types/operation.js">src/types/operation.js</a> for better understanding of all fields.</p>

<h4 id="operation-type">Operation Type</h4>

<p>As said above, an <code class="language-plaintext highlighter-rouge">Operation</code> has a <code class="language-plaintext highlighter-rouge">type</code> which is generic string typed as <code class="language-plaintext highlighter-rouge">OperationType</code>, giving more or less the direction of the operation:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">OUT</code>: A send / transfer amount transaction</li>
  <li><code class="language-plaintext highlighter-rouge">IN</code>: A received / incoming amount transaction</li>
  <li><code class="language-plaintext highlighter-rouge">FEES</code>: A transaction that only charges fees</li>
  <li><code class="language-plaintext highlighter-rouge">NONE</code>: A transaction that does not affect balance</li>
  <li><code class="language-plaintext highlighter-rouge">REWARD</code>: A claimed reward (as an outgoing transaction with fees)</li>
  <li><code class="language-plaintext highlighter-rouge">REWARD_PAYOUT</code>: A received reward (as an incoming transaction)</li>
  <li><code class="language-plaintext highlighter-rouge">SLASH</code>: A staking slash (with slashed amount generally)</li>
</ul>

<p>There are more types available, existing one will have predefined icons, translations and behaviours (i.e. <code class="language-plaintext highlighter-rouge">getOperationAmountNumber()</code> in <a href="https://github.com/Ledger-Coin-Integration-team/ledger-live-common/blob/master/src/operation.js">src/operation.js</a>).</p>

<p><em>MyCoin</em> could have also specific operation types, if you need to add a type that is not yet implemented, add them in <code class="language-plaintext highlighter-rouge">src/types/operation.js</code>. You will later need to implement some specific code for the Ledger Live Desktop and Mobile to display them correctly.</p>

<h4 id="transaction">Transaction</h4>

<p><code class="language-plaintext highlighter-rouge">Transaction</code> will contains any data needed to create a transaction on the blockchain. It is created as soon as the user initiates a transaction flow on Ledger Live, and will be updated according to its inputs, like the amount or choosing a recipient.</p>

<p>It shares a common shape between all coins, to which we will add specific-fields:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">amount: BigNumber</code>: amount parsed from user input - will be 0 if user use all amount</li>
  <li><code class="language-plaintext highlighter-rouge">recipient: string</code>: the recipient of this amount</li>
  <li><code class="language-plaintext highlighter-rouge">useAllAmount?: boolean</code>: indicated if user wants to transfer whole available balance</li>
  <li><code class="language-plaintext highlighter-rouge">subAccountId?: ?string</code>: the child/token account id if relevant</li>
  <li><code class="language-plaintext highlighter-rouge">family: string</code>: the coin-family of the transaction (as a coin discriminator)</li>
</ul>

<p>Some coins also have some fields generally respecting the same semantics, here are some provided as example:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">mode: string</code>: type of transaction to be broadcasted (<code class="language-plaintext highlighter-rouge">"send"</code>, <code class="language-plaintext highlighter-rouge">"freeze"</code>, <code class="language-plaintext highlighter-rouge">"delegate"</code>, <code class="language-plaintext highlighter-rouge">"claimReward"</code>…)</li>
  <li><code class="language-plaintext highlighter-rouge">fees: BigNumber</code>: fees (provided by blockchain, or filled by user)</li>
  <li><code class="language-plaintext highlighter-rouge">memo: ?string</code>: memo if required by exchange</li>
  <li>…</li>
</ul>

<p>Although some fields are required, they can be emptied (recipent = “” and amount = 0) and ignored for transactions making no use of it.</p>

<p>You should add any fields that would be required by <em>MyCoin</em> to be correctly broadcasted - respecting as much as possible its protocol’s lexicon.</p>

<p>See existing implementations for inspiration: <a href="https://github.com/LedgerHQ/ledger-live-common/blob/master/src/families/polkadot/types.js">Polkadot types</a>, <a href="https://github.com/LedgerHQ/ledger-live-common/blob/master/src/families/cosmos/types.js">Cosmos types</a></p>

<h4 id="family-specific-types">Family-specific types</h4>

<p>You will be implementing the flow types that will be used in your integration, like the Transaction type or the additional data needed to be added to the Account shared type, but also any other types that you will need (remember to always type your functions with flow types).</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/types.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">s</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span>
  <span class="nx">TransactionCommon</span><span class="p">,</span>
  <span class="nx">TransactionCommonRaw</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types/transaction</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// for legacy</span>
<span class="k">export</span> <span class="nx">type</span> <span class="nx">CoreStatics</span> <span class="o">=</span> <span class="p">{};</span>
<span class="k">export</span> <span class="nx">type</span> <span class="nx">CoreAccountSpecifics</span> <span class="o">=</span> <span class="p">{};</span>
<span class="k">export</span> <span class="nx">type</span> <span class="nx">CoreOperationSpecifics</span> <span class="o">=</span> <span class="p">{};</span>
<span class="k">export</span> <span class="nx">type</span> <span class="nx">CoreCurrencySpecifics</span> <span class="o">=</span> <span class="p">{};</span>

<span class="cm">/**
 * MyCoin account resources
 */</span>
<span class="k">export</span> <span class="nx">type</span> <span class="nx">MyCoinResources</span> <span class="o">=</span> <span class="p">{</span><span class="o">|</span>
  <span class="na">nonce</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
  <span class="na">additionalBalance</span><span class="p">:</span> <span class="nx">BigNumber</span><span class="p">,</span>
<span class="o">|</span><span class="p">};</span>

<span class="cm">/**
 * MyCoin account resources from raw JSON
 */</span>
<span class="k">export</span> <span class="nx">type</span> <span class="nx">MyCoinResourcesRaw</span> <span class="o">=</span> <span class="p">{</span><span class="o">|</span>
  <span class="na">nonce</span><span class="p">:</span> <span class="nx">number</span><span class="p">,</span>
  <span class="na">additionalBalance</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
<span class="o">|</span><span class="p">};</span>

<span class="cm">/**
 * MyCoin transaction
 */</span>
<span class="k">export</span> <span class="nx">type</span> <span class="nx">Transaction</span> <span class="o">=</span> <span class="p">{</span><span class="o">|</span>
  <span class="p">...</span><span class="nx">TransactionCommon</span><span class="p">,</span>
  <span class="na">mode</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
  <span class="na">family</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mycoin</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">fees</span><span class="p">:</span> <span class="p">?</span><span class="nx">BigNumber</span><span class="p">,</span>
  <span class="c1">// add here all transaction-specific fields if you implement other modes than "send"</span>
<span class="o">|</span><span class="p">};</span>

<span class="cm">/**
 * MyCoin transaction from a raw JSON
 */</span>
<span class="k">export</span> <span class="nx">type</span> <span class="nx">TransactionRaw</span> <span class="o">=</span> <span class="p">{</span><span class="o">|</span>
  <span class="p">...</span><span class="nx">TransactionCommonRaw</span><span class="p">,</span>
  <span class="na">family</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mycoin</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">mode</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
  <span class="na">fees</span><span class="p">:</span> <span class="p">?</span><span class="nx">string</span><span class="p">,</span>
  <span class="c1">// also the transaction fields as raw JSON data</span>
<span class="o">|</span><span class="p">};</span>

<span class="cm">/**
 * MyCoin currency data that will be preloaded.
 * You can for instance add a list of validators for Proof-of-Stake blockchains,
 * or any volatile data that could not be set as constants in the code (staking progress, fee estimation variables, etc.)
 */</span>
<span class="k">export</span> <span class="nx">type</span> <span class="nx">MyCoinPreloadData</span> <span class="o">=</span> <span class="p">{</span><span class="o">|</span>
  <span class="na">somePreloadedData</span><span class="p">:</span> <span class="nb">Object</span><span class="p">,</span>
<span class="o">|</span><span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">reflect</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_declare</span><span class="p">:</span> <span class="o">*</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{};</span>
</code></pre></div></div>

<p><em>Note: Core types should be exported for legacy compatibility with existing libcore integrations.</em></p>

<p>Since some of thoses types will be serialized when stored or cached, you may need to define serialize/deserialize functions for those:</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/serialization.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">MyCoinResourcesRaw</span><span class="p">,</span> <span class="nx">MyCoinResources</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./types</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">toMyCoinResourcesRaw</span><span class="p">(</span><span class="nx">r</span><span class="p">:</span> <span class="nx">MyCoinResources</span><span class="p">):</span> <span class="nx">MyCoinResourcesRaw</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">nonce</span><span class="p">,</span> <span class="nx">additionalBalance</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">nonce</span><span class="p">,</span>
    <span class="na">additionalBalance</span><span class="p">:</span> <span class="nx">additionalBalance</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">fromMyCoinResourcesRaw</span><span class="p">(</span><span class="nx">r</span><span class="p">:</span> <span class="nx">MyCoinResourcesRaw</span><span class="p">):</span> <span class="nx">MyCoinResources</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">nonce</span><span class="p">,</span> <span class="nx">additionalBalance</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">nonce</span><span class="p">,</span>
    <span class="na">additionalBalance</span><span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">additionalBalance</span><span class="p">),</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Because of Account being generic, you may need to add your specific resources to <code class="language-plaintext highlighter-rouge">src/types/account.js</code>…</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span>
  <span class="nx">MyCoinResources</span><span class="p">,</span>
  <span class="nx">MyCoinResourcesRaw</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../families/mycoin/types</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// export type Account = {</span>
<span class="c1">// ...</span>
<span class="c1">// // On some blockchain, an account can have resources (gained, delegated, ...)</span>
  <span class="nx">myCoinResources</span><span class="p">?:</span> <span class="nx">MyCoinResources</span><span class="p">,</span>
<span class="c1">// };</span>

<span class="c1">// export type AccountRaw = {</span>
  <span class="nx">myCoinResources</span><span class="p">?:</span> <span class="nx">MyCoinResourcesRaw</span><span class="p">,</span>
<span class="c1">// };</span>
</code></pre></div></div>

<p>…and handle the associated serialization in <code class="language-plaintext highlighter-rouge">src/account/serialization.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">toMyCoinResourcesRaw</span><span class="p">,</span>
  <span class="nx">fromMyCoinResourcesRaw</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../families/mycoin/serialization</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// ...</span>
<span class="k">export</span> <span class="p">{</span> <span class="nx">toMyCoinResourcesRaw</span><span class="p">,</span> <span class="nx">fromMyCoinResourcesRaw</span> <span class="p">};</span>
<span class="c1">// ...</span>

<span class="c1">// export function fromAccountRaw(rawAccount: AccountRaw): Account {</span>
<span class="c1">//   const {</span>
<span class="c1">//     ...</span>
    <span class="nx">myCoinResources</span><span class="p">,</span>
<span class="c1">// }</span>
<span class="c1">// ...</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">myCoinResources</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">myCoinResources</span> <span class="o">=</span> <span class="nx">fromMyCoinResourcesRaw</span><span class="p">(</span><span class="nx">myCoinResources</span><span class="p">);</span>
  <span class="p">}</span>
<span class="c1">//   return res;</span>
<span class="c1">// }</span>

<span class="c1">// export function toAccountRaw({</span>
<span class="c1">// ...</span>
  <span class="nx">myCoinResources</span><span class="p">,</span>
<span class="c1">// }: Account): AccountRaw {</span>
<span class="c1">// ...</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">myCoinResources</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">myCoinResources</span> <span class="o">=</span> <span class="nx">toMyCoinResourcesRaw</span><span class="p">(</span><span class="nx">myCoinResources</span><span class="p">);</span>
  <span class="p">}</span>
<span class="c1">//   return res;</span>
<span class="c1">// }</span>
</code></pre></div></div>

<p><em>Note: if your integration of MyCoin does not require coin-specific data in an account, you will not need to define <code class="language-plaintext highlighter-rouge">MyCoinResources</code>.</em></p>

<h4 id="operation-account-and-transaction-serialization">Operation, Account and Transaction serialization</h4>

<p>Since <code class="language-plaintext highlighter-rouge">Operation</code> will be stored as JSON, you will need to implement specific serializers for the <code class="language-plaintext highlighter-rouge">extra</code> field.</p>

<p>We also would like the <code class="language-plaintext highlighter-rouge">Operation</code> and <code class="language-plaintext highlighter-rouge">Account</code> to be displayed in CLI with their specifics, so you must provide formatters to display them.</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/account.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="nx">invariant</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">invariant</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Account</span><span class="p">,</span> <span class="nx">Operation</span><span class="p">,</span> <span class="nx">Unit</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">getAccountUnit</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../account</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">formatCurrencyUnit</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../currencies</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">formatAccountSpecifics</span><span class="p">(</span><span class="nx">account</span><span class="p">:</span> <span class="nx">Account</span><span class="p">):</span> <span class="nx">string</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">myCoinResources</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">account</span><span class="p">;</span>
  <span class="nx">invariant</span><span class="p">(</span><span class="nx">myCoinResources</span><span class="p">,</span> <span class="dl">"</span><span class="s2">mycoin account expected</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">unit</span> <span class="o">=</span> <span class="nx">getAccountUnit</span><span class="p">(</span><span class="nx">account</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">formatConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">disableRounding</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">alwaysShowSign</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">showCode</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">let</span> <span class="nx">str</span> <span class="o">=</span> <span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">;</span>

  <span class="nx">str</span> <span class="o">+=</span>
    <span class="nx">formatCurrencyUnit</span><span class="p">(</span><span class="nx">unit</span><span class="p">,</span> <span class="nx">account</span><span class="p">.</span><span class="nx">spendableBalance</span><span class="p">,</span> <span class="nx">formatConfig</span><span class="p">)</span> <span class="o">+</span>
    <span class="dl">"</span><span class="s2"> spendable. </span><span class="dl">"</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">myCoinResources</span><span class="p">.</span><span class="nx">additionalBalance</span><span class="p">.</span><span class="nx">gt</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">str</span> <span class="o">+=</span>
      <span class="nx">formatCurrencyUnit</span><span class="p">(</span>
        <span class="nx">unit</span><span class="p">,</span>
        <span class="nx">myCoinResources</span><span class="p">.</span><span class="nx">additionalBalance</span><span class="p">,</span>
        <span class="nx">formatConfig</span>
      <span class="p">)</span> <span class="o">+</span> <span class="dl">"</span><span class="s2"> additional. </span><span class="dl">"</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">myCoinResources</span><span class="p">.</span><span class="nx">nonce</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">str</span> <span class="o">+=</span> <span class="dl">"</span><span class="se">\n</span><span class="s2">once : </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">myCoinResources</span><span class="p">.</span><span class="nx">nonce</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">formatOperationSpecifics</span><span class="p">(</span><span class="nx">op</span><span class="p">:</span> <span class="nx">Operation</span><span class="p">,</span> <span class="nx">unit</span><span class="p">:</span> <span class="p">?</span><span class="nx">Unit</span><span class="p">):</span> <span class="nx">string</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">additionalField</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">op</span><span class="p">.</span><span class="nx">extra</span><span class="p">;</span>

  <span class="kd">let</span> <span class="nx">str</span> <span class="o">=</span> <span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">formatConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">disableRounding</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">alwaysShowSign</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">showCode</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="nx">str</span> <span class="o">+=</span>
    <span class="nx">additionalField</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">additionalField</span><span class="p">.</span><span class="nb">isNaN</span><span class="p">()</span>
      <span class="p">?</span> <span class="s2">`\n    additionalField: </span><span class="p">${</span>
          <span class="nx">unit</span>
            <span class="p">?</span> <span class="nx">formatCurrencyUnit</span><span class="p">(</span><span class="nx">unit</span><span class="p">,</span> <span class="nx">additionalField</span><span class="p">,</span> <span class="nx">formatConfig</span><span class="p">)</span>
            <span class="p">:</span> <span class="nx">additionalField</span>
        <span class="p">}</span><span class="s2">`</span>
      <span class="p">:</span> <span class="dl">""</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">fromOperationExtraRaw</span><span class="p">(</span><span class="nx">extra</span><span class="p">:</span> <span class="p">?</span><span class="nb">Object</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">extra</span> <span class="o">&amp;&amp;</span> <span class="nx">extra</span><span class="p">.</span><span class="nx">additionalField</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">extra</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">...</span><span class="nx">extra</span><span class="p">,</span>
      <span class="na">additionalField</span><span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">extra</span><span class="p">.</span><span class="nx">additionalField</span><span class="p">),</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">extra</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">toOperationExtraRaw</span><span class="p">(</span><span class="nx">extra</span><span class="p">:</span> <span class="p">?</span><span class="nb">Object</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">extra</span> <span class="o">&amp;&amp;</span> <span class="nx">extra</span><span class="p">.</span><span class="nx">additionalField</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">extra</span> <span class="o">=</span> <span class="p">{</span>
      <span class="p">...</span><span class="nx">extra</span><span class="p">,</span>
      <span class="na">additionalField</span><span class="p">:</span> <span class="nx">extra</span><span class="p">.</span><span class="nx">additionalField</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">extra</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">formatAccountSpecifics</span><span class="p">,</span>
  <span class="nx">formatOperationSpecifics</span><span class="p">,</span>
  <span class="nx">fromOperationExtraRaw</span><span class="p">,</span>
  <span class="nx">toOperationExtraRaw</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div></div>

<p><em>NOTE: <code class="language-plaintext highlighter-rouge">formatOperationSpecifics()</code> and <code class="language-plaintext highlighter-rouge">formatAccountSpecifics()</code> are used in the CLI to display account-specific fields and extras of the transaction history, useful for debugging.</em></p>

<p>The same idea applies also to the <code class="language-plaintext highlighter-rouge">Transaction</code> type which needs to be serialized and formatted for CLI:</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/transaction.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Transaction</span><span class="p">,</span> <span class="nx">TransactionRaw</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">fromTransactionCommonRaw</span><span class="p">,</span>
  <span class="nx">toTransactionCommonRaw</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../transaction/common</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Account</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">getAccountUnit</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../account</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">formatCurrencyUnit</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../currencies</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">formatTransaction</span> <span class="o">=</span> <span class="p">(</span>
  <span class="p">{</span> <span class="nx">mode</span><span class="p">,</span> <span class="nx">amount</span><span class="p">,</span> <span class="nx">recipient</span><span class="p">,</span> <span class="nx">useAllAmount</span> <span class="p">}:</span> <span class="nx">Transaction</span><span class="p">,</span>
  <span class="nx">account</span><span class="p">:</span> <span class="nx">Account</span>
<span class="p">):</span> <span class="nx">string</span> <span class="o">=&gt;</span>
  <span class="s2">`
</span><span class="p">${</span><span class="nx">mode</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()}</span><span class="s2"> </span><span class="p">${</span>
    <span class="nx">useAllAmount</span>
      <span class="p">?</span> <span class="dl">"</span><span class="s2">MAX</span><span class="dl">"</span>
      <span class="p">:</span> <span class="nx">amount</span><span class="p">.</span><span class="nx">isZero</span><span class="p">()</span>
      <span class="p">?</span> <span class="dl">""</span>
      <span class="p">:</span> <span class="dl">"</span><span class="s2"> </span><span class="dl">"</span> <span class="o">+</span>
        <span class="nx">formatCurrencyUnit</span><span class="p">(</span><span class="nx">getAccountUnit</span><span class="p">(</span><span class="nx">account</span><span class="p">),</span> <span class="nx">amount</span><span class="p">,</span> <span class="p">{</span>
          <span class="na">showCode</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="na">disableRounding</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">})</span>
  <span class="p">}${</span><span class="nx">recipient</span> <span class="p">?</span> <span class="s2">`\nTO </span><span class="p">${</span><span class="nx">recipient</span><span class="p">}</span><span class="s2">`</span> <span class="p">:</span> <span class="dl">""</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">fromTransactionRaw</span> <span class="o">=</span> <span class="p">(</span><span class="nx">tr</span><span class="p">:</span> <span class="nx">TransactionRaw</span><span class="p">):</span> <span class="nx">Transaction</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">fromTransactionCommonRaw</span><span class="p">(</span><span class="nx">tr</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">common</span><span class="p">,</span>
    <span class="na">family</span><span class="p">:</span> <span class="nx">tr</span><span class="p">.</span><span class="nx">family</span><span class="p">,</span>
    <span class="na">mode</span><span class="p">:</span> <span class="nx">tr</span><span class="p">.</span><span class="nx">mode</span><span class="p">,</span>
    <span class="na">fees</span><span class="p">:</span> <span class="nx">tr</span><span class="p">.</span><span class="nx">fees</span> <span class="p">?</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">tr</span><span class="p">.</span><span class="nx">fees</span><span class="p">)</span> <span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">toTransactionRaw</span> <span class="o">=</span> <span class="p">(</span><span class="nx">t</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">):</span> <span class="nx">TransactionRaw</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">toTransactionCommonRaw</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">common</span><span class="p">,</span>
    <span class="na">family</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">family</span><span class="p">,</span>
    <span class="na">mode</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">mode</span><span class="p">,</span>
    <span class="na">fees</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">fees</span><span class="p">?.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">||</span> <span class="kc">null</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span> <span class="nx">formatTransaction</span><span class="p">,</span> <span class="nx">fromTransactionRaw</span><span class="p">,</span> <span class="nx">toTransactionRaw</span> <span class="p">};</span>
</code></pre></div></div>

<h3 id="wrap-your-api">Wrap your API</h3>

<p>Before this part, you will need an indexer/explorer to get a list of operations. You may also obtain from it, or from a SDK, the state of an account on the blockchain, such as balances, nonce (if your blockchain uses something similar), and any data relevant to show or fetch in Ledger Live.</p>

<p>For the example, we will assume that <em>MyCoin</em> provides a SDK that is able to do both getting the state and the account history.</p>

<p>The best way to implement your API in Live Common is to create a dedicated <code class="language-plaintext highlighter-rouge">api</code> subfolder, that exports all functions that require calls to 3rd-party and map their responses to Ledger Live types.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./src/families/mycoin
└── api
  ├── index.js
  ├── sdk.js
  └── sdk.types.js
</code></pre></div></div>

<p><em>NOTE: try to separate as much as possible your different APIs (if you use multiple providers) and use typings to ensure you map correctly API responses to Ledger Live types</em></p>

<p>You will likely need to export thoses functions, but implemention is up-to-developer:</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/api/index.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="p">{</span>
  <span class="nx">getAccount</span><span class="p">,</span>
  <span class="nx">getOperations</span><span class="p">,</span>
  <span class="nx">getPreloadedData</span><span class="p">,</span> <span class="c1">// adjust with needs of preloaded data</span>
  <span class="nx">getFees</span><span class="p">,</span>
  <span class="nx">submit</span><span class="p">,</span>
  <span class="nx">disconnect</span><span class="p">,</span> <span class="c1">// if using persisting connection</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./sdk</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<p>Basically, in the next sections, <code class="language-plaintext highlighter-rouge">getAccount</code> will be called to create an <code class="language-plaintext highlighter-rouge">Account</code> with balances and any additional resources, and <code class="language-plaintext highlighter-rouge">getOperations</code> will be called to fill the <code class="language-plaintext highlighter-rouge">operations[]</code> of this account, with the whole history of operations that can be requested incrementally. Then <code class="language-plaintext highlighter-rouge">getFees</code> before sending a transaction to let the user know of the network cost (estimated or effective), and <code class="language-plaintext highlighter-rouge">submit</code> to broadcast its transaction after signing.</p>

<p>See <a href="https://github.com/LedgerHQ/ledger-live-common/tree/master/src/families/polkadot/api">Polkadot Coin Integration’s api</a> for good inspiration.</p>

<h4 id="api-example">API Example</h4>

<p>Here is an example of a MyCoin API implementation using a fictive SDK that uses something like WebSocket to fetch data.</p>

<p><em>NOTE: We don’t recommend using WebSocket as it could have drawbacks and is more difficult to scale up and put behind a reverse proxy. If possible, use HTTPS requests as much as possible.</em></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="nx">MyCoinApi</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">my-coin-sdk</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">MyCoinTransaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">my-coin-sdk</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Operation</span><span class="p">,</span> <span class="nx">OperationType</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">getEnv</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../../env</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">encodeOperationId</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../../operation</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">type</span> <span class="nx">AsyncApiFunction</span> <span class="o">=</span> <span class="p">(</span><span class="nx">api</span><span class="p">:</span> <span class="k">typeof</span> <span class="nx">MyCoinApi</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">MYCOIN_API_ENDPOINT</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">getEnv</span><span class="p">(</span><span class="dl">"</span><span class="s2">MYCOIN_API_ENDPOINT</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">api</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="cm">/**
 * Connects to MyCoin Api
 */</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">withApi</span><span class="p">(</span><span class="nx">execute</span><span class="p">:</span> <span class="nx">AsyncApiFunction</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c1">// If client is instanciated already, ensure it is connected &amp; ready</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">api</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">isReady</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">api</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">api</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">api</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCoinApi</span><span class="p">(</span><span class="nx">MYCOIN_API_ENDPOINT</span><span class="p">);</span>
    <span class="nx">api</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
    <span class="nx">api</span><span class="p">.</span><span class="nx">onClose</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">api</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">isReady</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">api</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">res</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="c1">// Handle Error or Retry</span>
    <span class="k">await</span> <span class="nx">disconnect</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**
 * Disconnects MyCoin Api
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">disconnect</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">api</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">disconnecting</span> <span class="o">=</span> <span class="nx">api</span><span class="p">;</span>
    <span class="nx">api</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">await</span> <span class="nx">disconnecting</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**
 * Get account balances and nonce
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">getAccount</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">addr</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="nx">withApi</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">api</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">balance</span><span class="p">,</span> <span class="nx">additionalBalance</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">getBalances</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">nonce</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">getNonce</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">blockHeight</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">getBlockHeight</span><span class="p">();</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">blockHeight</span><span class="p">,</span>
      <span class="na">balance</span><span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">balance</span><span class="p">),</span>
      <span class="na">additionalBalance</span><span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">additionalBalance</span><span class="p">),</span>
      <span class="nx">nonce</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">});</span>

<span class="cm">/**
 * Returns true if account is the signer
 */</span>
<span class="kd">function</span> <span class="nx">isSender</span><span class="p">(</span><span class="nx">transaction</span><span class="p">:</span> <span class="nx">MyCoinTransaction</span><span class="p">,</span> <span class="nx">addr</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">sender</span> <span class="o">===</span> <span class="nx">addr</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**
 * Map transaction to an Operation Type
 */</span>
<span class="kd">function</span> <span class="nx">getOperationType</span><span class="p">(</span>
  <span class="nx">transaction</span><span class="p">:</span> <span class="nx">MyCoinTransaction</span><span class="p">,</span>
  <span class="nx">addr</span><span class="p">:</span> <span class="nx">string</span>
<span class="p">):</span> <span class="nx">OperationType</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">isSender</span><span class="p">(</span><span class="nx">transaction</span><span class="p">,</span> <span class="nx">addr</span><span class="p">)</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">OUT</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">IN</span><span class="dl">"</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**
 * Map transaction to a correct Operation Value (affecting account balance)
 */</span>
<span class="kd">function</span> <span class="nx">getOperationValue</span><span class="p">(</span>
  <span class="nx">transaction</span><span class="p">:</span> <span class="nx">MyCoinTransaction</span><span class="p">,</span>
  <span class="nx">addr</span><span class="p">:</span> <span class="nx">string</span>
<span class="p">):</span> <span class="nx">BigNumber</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">isSender</span><span class="p">(</span><span class="nx">transaction</span><span class="p">,</span> <span class="nx">addr</span><span class="p">)</span>
    <span class="p">?</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">value</span><span class="p">).</span><span class="nx">plus</span><span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">fees</span><span class="p">)</span>
    <span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * Extract extra from transaction if any
 */</span>
<span class="kd">function</span> <span class="nx">getOperationExtra</span><span class="p">(</span><span class="nx">transaction</span><span class="p">:</span> <span class="nx">MyCoinTransaction</span><span class="p">):</span> <span class="nb">Object</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">additionalField</span><span class="p">:</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">additionalField</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="cm">/**
 * Map the MyCoin history transaction to a Ledger Live Operation
 */</span>
<span class="kd">function</span> <span class="nx">transactionToOperation</span><span class="p">(</span>
  <span class="nx">accountId</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
  <span class="nx">addr</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
  <span class="nx">transaction</span><span class="p">:</span> <span class="nx">MyCoinTransaction</span>
<span class="p">):</span> <span class="nx">Operation</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">getOperationType</span><span class="p">(</span><span class="nx">transaction</span><span class="p">,</span> <span class="nx">addr</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">id</span><span class="p">:</span> <span class="nx">encodeOperationId</span><span class="p">(</span><span class="nx">accountId</span><span class="p">,</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">type</span><span class="p">),</span>
    <span class="nx">accountId</span><span class="p">,</span>
    <span class="na">fee</span><span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">fees</span> <span class="o">||</span> <span class="mi">0</span><span class="p">),</span>
    <span class="na">value</span><span class="p">:</span> <span class="nx">getOperationValue</span><span class="p">(</span><span class="nx">transaction</span><span class="p">,</span> <span class="nx">addr</span><span class="p">),</span>
    <span class="nx">type</span><span class="p">,</span>
    <span class="na">hash</span><span class="p">:</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span>
    <span class="na">blockHash</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="na">blockHeight</span><span class="p">:</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">blockNumber</span><span class="p">,</span>
    <span class="na">date</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">),</span>
    <span class="na">extra</span><span class="p">:</span> <span class="nx">getOperationExtra</span><span class="p">(</span><span class="nx">transaction</span><span class="p">),</span>
    <span class="na">senders</span><span class="p">:</span> <span class="p">[</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">sender</span><span class="p">],</span>
    <span class="na">recipients</span><span class="p">:</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">recipient</span> <span class="p">?</span> <span class="p">[</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">recipient</span><span class="p">]</span> <span class="p">:</span> <span class="p">[],</span>
    <span class="na">transactionSequenceNumber</span><span class="p">:</span> <span class="nx">isSender</span><span class="p">(</span><span class="nx">transaction</span><span class="p">,</span> <span class="nx">addr</span><span class="p">)</span>
      <span class="p">?</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">nonce</span>
      <span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
    <span class="na">hasFailed</span><span class="p">:</span> <span class="o">!</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">success</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="cm">/**
 * Fetch operation list
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">getOperations</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span>
  <span class="nx">accountId</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
  <span class="nx">addr</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
  <span class="nx">startAt</span><span class="p">:</span> <span class="nx">number</span>
<span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Operation</span><span class="p">[]</span><span class="o">&gt;</span> <span class="o">=&gt;</span>
  <span class="nx">withApi</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">api</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">rawTransactions</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">getHistory</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span> <span class="nx">startAt</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">rawTransactions</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">transaction</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nx">transactionToOperation</span><span class="p">(</span><span class="nx">accountId</span><span class="p">,</span> <span class="nx">addr</span><span class="p">,</span> <span class="nx">transaction</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">});</span>

<span class="cm">/**
 * Obtain fees from blockchain
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">getFees</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">unsigned</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">BigNumber</span><span class="o">&gt;</span> <span class="o">=&gt;</span>
  <span class="nx">withApi</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">api</span><span class="p">:</span> <span class="k">typeof</span> <span class="nx">MyCoinApi</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">fees</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">dryRun</span><span class="p">(</span><span class="nx">unsigned</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">fees</span><span class="p">);</span>
  <span class="p">});</span>

<span class="cm">/**
 * Broadcast blob to blockchain
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">submit</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">blob</span><span class="p">:</span> <span class="nx">string</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="nx">withApi</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">api</span><span class="p">:</span> <span class="k">typeof</span> <span class="nx">MyCoinApi</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">fees</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">api</span><span class="p">.</span><span class="nx">submit</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>

    <span class="c1">// Transaction hash is likely to be returned</span>
    <span class="k">return</span> <span class="p">{</span> <span class="nx">hash</span><span class="p">,</span> <span class="na">fees</span><span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">fees</span><span class="p">)</span> <span class="p">};</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>If you need to disconnect from your API after using it, update <code class="language-plaintext highlighter-rouge">src/api/index.js</code> to add your api disconnect in the <code class="language-plaintext highlighter-rouge">disconnectAll</code> function, it will avoid tests and CLI to hang.</p>

<h3 id="js-bridge">JS Bridge</h3>

<p><code class="language-plaintext highlighter-rouge">bridge/js.js</code> is the entry point of a coin integration. It must export two bridges:</p>

<ul>
  <li>a CurrencyBridge</li>
  <li>an AccountBridge</li>
</ul>

<h4 id="starting-with-a-mock">Starting with a mock</h4>

<p>TO BE WRITTEN</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">NotEnoughBalance</span><span class="p">,</span>
  <span class="nx">RecipientRequired</span><span class="p">,</span>
  <span class="nx">InvalidAddress</span><span class="p">,</span>
  <span class="nx">FeeTooHigh</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@ledgerhq/errors</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Transaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">AccountBridge</span><span class="p">,</span> <span class="nx">CurrencyBridge</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">scanAccounts</span><span class="p">,</span>
  <span class="nx">signOperation</span><span class="p">,</span>
  <span class="nx">broadcast</span><span class="p">,</span>
  <span class="nx">sync</span><span class="p">,</span>
  <span class="nx">isInvalidRecipient</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../../bridge/mockHelpers</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">getMainAccount</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../../account</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">makeAccountBridgeReceive</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../../bridge/mockHelpers</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">receive</span> <span class="o">=</span> <span class="nx">makeAccountBridgeReceive</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">createTransaction</span> <span class="o">=</span> <span class="p">():</span> <span class="nx">Transaction</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">family</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mycoin</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">send</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">amount</span><span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
  <span class="na">recipient</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span>
  <span class="na">useAllAmount</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">fees</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">updateTransaction</span> <span class="o">=</span> <span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">patch</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="p">...</span><span class="nx">t</span><span class="p">,</span> <span class="p">...</span><span class="nx">patch</span> <span class="p">});</span>

<span class="kd">const</span> <span class="nx">prepareTransaction</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">t</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">estimateMaxSpendable</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">account</span><span class="p">,</span> <span class="nx">parentAccount</span><span class="p">,</span> <span class="nx">transaction</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">mainAccount</span> <span class="o">=</span> <span class="nx">getMainAccount</span><span class="p">(</span><span class="nx">account</span><span class="p">,</span> <span class="nx">parentAccount</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">estimatedFees</span> <span class="o">=</span> <span class="nx">transaction</span><span class="p">?.</span><span class="nx">fees</span> <span class="o">||</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span>
    <span class="nx">BigNumber</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">mainAccount</span><span class="p">.</span><span class="nx">balance</span><span class="p">.</span><span class="nx">minus</span><span class="p">(</span><span class="nx">estimatedFees</span><span class="p">))</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">getTransactionStatus</span> <span class="o">=</span> <span class="p">(</span><span class="nx">account</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">const</span> <span class="nx">warnings</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">const</span> <span class="nx">useAllAmount</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">t</span><span class="p">.</span><span class="nx">useAllAmount</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">estimatedFees</span> <span class="o">=</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">totalSpent</span> <span class="o">=</span> <span class="nx">useAllAmount</span>
    <span class="p">?</span> <span class="nx">account</span><span class="p">.</span><span class="nx">balance</span>
    <span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">amount</span><span class="p">).</span><span class="nx">plus</span><span class="p">(</span><span class="nx">estimatedFees</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">useAllAmount</span>
    <span class="p">?</span> <span class="nx">account</span><span class="p">.</span><span class="nx">balance</span><span class="p">.</span><span class="nx">minus</span><span class="p">(</span><span class="nx">estimatedFees</span><span class="p">)</span>
    <span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">amount</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">amount</span><span class="p">.</span><span class="nx">gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">estimatedFees</span><span class="p">.</span><span class="nx">times</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nx">gt</span><span class="p">(</span><span class="nx">amount</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">warnings</span><span class="p">.</span><span class="nx">amount</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FeeTooHigh</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">totalSpent</span><span class="p">.</span><span class="nx">gt</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">balance</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">amount</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NotEnoughBalance</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">recipient</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">recipient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RecipientRequired</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isInvalidRecipient</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">recipient</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">recipient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InvalidAddress</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span>
    <span class="nx">errors</span><span class="p">,</span>
    <span class="nx">warnings</span><span class="p">,</span>
    <span class="nx">estimatedFees</span><span class="p">,</span>
    <span class="nx">amount</span><span class="p">,</span>
    <span class="nx">totalSpent</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">accountBridge</span><span class="p">:</span> <span class="nx">AccountBridge</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">estimateMaxSpendable</span><span class="p">,</span>
  <span class="nx">createTransaction</span><span class="p">,</span>
  <span class="nx">updateTransaction</span><span class="p">,</span>
  <span class="nx">getTransactionStatus</span><span class="p">,</span>
  <span class="nx">prepareTransaction</span><span class="p">,</span>
  <span class="nx">sync</span><span class="p">,</span>
  <span class="nx">receive</span><span class="p">,</span>
  <span class="nx">signOperation</span><span class="p">,</span>
  <span class="nx">broadcast</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">currencyBridge</span><span class="p">:</span> <span class="nx">CurrencyBridge</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">scanAccounts</span><span class="p">,</span>
  <span class="na">preload</span><span class="p">:</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{},</span>
  <span class="na">hydrate</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{},</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span> <span class="nx">currencyBridge</span><span class="p">,</span> <span class="nx">accountBridge</span> <span class="p">};</span>
</code></pre></div></div>

<h4 id="split-your-code">Split your code</h4>

<p>You can now start to implement the JS bridge for <em>MyCoin</em>. It may need some changes back and forth between the types, your api wrapper, and the differente files.</p>

<p>The skeleton of <code class="language-plaintext highlighter-rouge">src/families/mycoin/bridge/js.js</code> should look something like this:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">AccountBridge</span><span class="p">,</span> <span class="nx">CurrencyBridge</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Transaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">makeAccountBridgeReceive</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../../bridge/jsHelpers</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">getPreloadStrategy</span><span class="p">,</span> <span class="nx">preload</span><span class="p">,</span> <span class="nx">hydrate</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../preload</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">sync</span><span class="p">,</span> <span class="nx">scanAccounts</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../js-synchronisation</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">createTransaction</span><span class="p">,</span>
  <span class="nx">updateTransaction</span><span class="p">,</span>
  <span class="nx">prepareTransaction</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../js-transaction</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">getTransactionStatus</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../js-getTransactionStatus</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">estimateMaxSpendable</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../js-estimateMaxSpendable</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">signOperation</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../js-signOperation</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">broadcast</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../js-broadcast</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">receive</span> <span class="o">=</span> <span class="nx">makeAccountBridgeReceive</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">currencyBridge</span><span class="p">:</span> <span class="nx">CurrencyBridge</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">getPreloadStrategy</span><span class="p">,</span>
  <span class="nx">preload</span><span class="p">,</span>
  <span class="nx">hydrate</span><span class="p">,</span>
  <span class="nx">scanAccounts</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">accountBridge</span><span class="p">:</span> <span class="nx">AccountBridge</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">estimateMaxSpendable</span><span class="p">,</span>
  <span class="nx">createTransaction</span><span class="p">,</span>
  <span class="nx">updateTransaction</span><span class="p">,</span>
  <span class="nx">getTransactionStatus</span><span class="p">,</span>
  <span class="nx">prepareTransaction</span><span class="p">,</span>
  <span class="nx">sync</span><span class="p">,</span>
  <span class="nx">receive</span><span class="p">,</span>
  <span class="nx">signOperation</span><span class="p">,</span>
  <span class="nx">broadcast</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span> <span class="nx">currencyBridge</span><span class="p">,</span> <span class="nx">accountBridge</span> <span class="p">};</span>
</code></pre></div></div>

<p><em>Note: you could implement all the methods in a single file, but for better readability and maintainability, you should split your code into multiple files.</em></p>

<h3 id="account-bridge">Account Bridge</h3>

<p>AccountBridge offers a generic abstraction to synchronize accounts and perform transactions.</p>

<p>It is designed for the end user frontend interface and is agnostic of the way it runs, has multiple implementations and does not know how the data is even stored: in fact <strong>it’s just a set of stateless functions</strong>.</p>

<p><img src="../images/account-bridge-flow.png" alt="account bridge flow" /></p>

<h4 id="receive">Receive</h4>

<p>The <code class="language-plaintext highlighter-rouge">receive</code> method allows to derivate address of an account with a Nano device but also display it on the device if verify is passed in.
As you may see in <code class="language-plaintext highlighter-rouge">src/families/mycoin/bridge.js</code>, Live Common provides a helper to implement it easily with <code class="language-plaintext highlighter-rouge">makeAccountBridgeReceive()</code>, and there is a very few reason to implement your own.</p>

<h4 id="synchronization">Synchronization</h4>

<p>We usually group the <code class="language-plaintext highlighter-rouge">scanAccounts</code> and <code class="language-plaintext highlighter-rouge">sync</code> into the same file <code class="language-plaintext highlighter-rouge">js-synchronisation.js</code> as they both use similar logic as a <code class="language-plaintext highlighter-rouge">getAccountShape</code> function passed to helpers.</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/js-synchronisation.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//@flow</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Account</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">GetAccountShape</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../bridge/jsHelpers</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">makeSync</span><span class="p">,</span> <span class="nx">makeScanAccounts</span><span class="p">,</span> <span class="nx">mergeOps</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../bridge/jsHelpers</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">getAccount</span><span class="p">,</span> <span class="nx">getOperations</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./api</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">getAccountShape</span><span class="p">:</span> <span class="nx">GetAccountShape</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">address</span><span class="p">,</span> <span class="nx">initialAccount</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">info</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">oldOperations</span> <span class="o">=</span> <span class="nx">initialAccount</span><span class="p">?.</span><span class="nx">operations</span> <span class="o">||</span> <span class="p">[];</span>

  <span class="c1">// Needed for incremental synchronisation</span>
  <span class="kd">const</span> <span class="nx">startAt</span> <span class="o">=</span> <span class="nx">oldOperations</span><span class="p">.</span><span class="nx">length</span>
    <span class="p">?</span> <span class="p">(</span><span class="nx">oldOperations</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">blockHeight</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// get the current account balance state depending your api implementation</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">blockHeight</span><span class="p">,</span> <span class="nx">balance</span><span class="p">,</span> <span class="nx">additionalBalance</span><span class="p">,</span> <span class="nx">nonce</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getAccount</span><span class="p">(</span>
    <span class="nx">address</span>
  <span class="p">);</span>

  <span class="c1">// Merge new operations with the previously synced ones</span>
  <span class="kd">const</span> <span class="nx">newOperations</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getOperations</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">address</span><span class="p">,</span> <span class="nx">startAt</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">operations</span> <span class="o">=</span> <span class="nx">mergeOps</span><span class="p">(</span><span class="nx">oldOperations</span><span class="p">,</span> <span class="nx">newOperations</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">shape</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">id</span><span class="p">,</span>
    <span class="nx">balance</span><span class="p">,</span>
    <span class="na">spendableBalance</span><span class="p">:</span> <span class="nx">balance</span><span class="p">,</span>
    <span class="na">operationsCount</span><span class="p">:</span> <span class="nx">operations</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
    <span class="nx">blockHeight</span><span class="p">,</span>
    <span class="na">myCoinResources</span><span class="p">:</span> <span class="p">{</span>
      <span class="nx">nonce</span><span class="p">,</span>
      <span class="nx">additionalBalance</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">shape</span><span class="p">,</span> <span class="nx">operations</span> <span class="p">};</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">postSync</span> <span class="o">=</span> <span class="p">(</span><span class="nx">initial</span><span class="p">:</span> <span class="nx">Account</span><span class="p">,</span> <span class="nx">parent</span><span class="p">:</span> <span class="nx">Account</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">parent</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">scanAccounts</span> <span class="o">=</span> <span class="nx">makeScanAccounts</span><span class="p">(</span><span class="nx">getAccountShape</span><span class="p">);</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">sync</span> <span class="o">=</span> <span class="nx">makeSync</span><span class="p">(</span><span class="nx">getAccountShape</span><span class="p">,</span> <span class="nx">postSync</span><span class="p">);</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">scanAccounts</code> function performs the derivation of addresses for a given <code class="language-plaintext highlighter-rouge">currency</code> and <code class="language-plaintext highlighter-rouge">deviceId</code>, and returns an Observable that will notify every <code class="language-plaintext highlighter-rouge">Account</code> that it discovered.</p>

<p>With the <code class="language-plaintext highlighter-rouge">makeScanAccounts</code> helper, you only have to pass a <code class="language-plaintext highlighter-rouge">getAccountShape</code> function to execute the generic scan that Ledger Live use with the correct derivation modes for <em>MyCoin</em>, and it will determine when to stop (generally as soon as an empty account was found).</p>

<p>The <code class="language-plaintext highlighter-rouge">sync</code> function performs one “Account synchronisation” which consists of refreshing all fields of a (previously created) Account from your api.</p>

<p>It is executed every 2 minutes if everything works as expected, but if it fails, a retry strategy will be executed with an increasing delay (to avoid burdening a failing API).</p>

<p>Under the hood of the <code class="language-plaintext highlighter-rouge">makeSync</code> helper, the returned value is an Observable of an updater function (Account=&gt;Account), which is a pattern having some advantages:</p>

<ul>
  <li>it avoids race conditions</li>
  <li>the updater is called in a reducer, and allows to produce an immutable state by applying the update to the latest account instance (with reconciliation on Ledger Live Desktop)</li>
  <li>it’s an observable, so we can interrupt it when/if multiple updates occurs</li>
</ul>

<p>In some cases, you might need to do a <code class="language-plaintext highlighter-rouge">postSync</code> patch to add some update logic after sync (<em>before the reconciliation that occurs on Ledger Live Desktop</em>). If this <code class="language-plaintext highlighter-rouge">postSync</code> function is complex, you should split this function in a <code class="language-plaintext highlighter-rouge">src/families/mycoin/js-postSyncPatch.js</code> file.</p>

<h4 id="reconciliation">Reconciliation</h4>

<p>Currently, Ledger Live Desktop executes this bridge in a separate thread. Thus, the “avoid race condition” aspect of sync might not be respected since the UI renderer thread does not share the same objects.
This may be improved in the future, but for updates to be reflected during sync, we implemented reconciliation in <a href="https://github.com/Ledger-Coin-Integration-team/ledger-live-common/blob/master/src/reconciliation.js">src/reconciliation.js</a>, between the account that is in the renderer and the new account produced after sync.</p>

<p>Since we might have added some coin-specific data in <code class="language-plaintext highlighter-rouge">Account</code>, we must also reconciliate it:</p>

<p><code class="language-plaintext highlighter-rouge">src/reconciliation</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// import {</span>
<span class="c1">// ...</span>
  <span class="nx">fromMyCoinResourcesRaw</span><span class="p">,</span>
<span class="c1">// } from "./account";</span>
<span class="c1">// ...</span>
<span class="c1">// export function patchAccount(</span>
<span class="c1">//   account: Account,</span>
<span class="c1">//   updatedRaw: AccountRaw</span>
<span class="c1">// ): Account {</span>
<span class="c1">// ...</span>
  <span class="k">if</span> <span class="p">(</span>
    <span class="nx">updatedRaw</span><span class="p">.</span><span class="nx">myCoinResources</span> <span class="o">&amp;&amp;</span>
    <span class="nx">account</span><span class="p">.</span><span class="nx">myCoinResources</span> <span class="o">!==</span> <span class="nx">updatedRaw</span><span class="p">.</span><span class="nx">myCoinResources</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="nx">next</span><span class="p">.</span><span class="nx">myCoinResources</span> <span class="o">=</span> <span class="nx">fromMyCoinResourcesRaw</span><span class="p">(</span>
      <span class="nx">updatedRaw</span><span class="p">.</span><span class="nx">myCoinResources</span>
    <span class="p">);</span>
    <span class="nx">changed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="c1">//   if (!changed) return account; // nothing changed at all</span>
<span class="c1">//</span>
<span class="c1">//   return next;</span>
<span class="c1">// }</span>
</code></pre></div></div>

<h4 id="transactions">Transactions</h4>

<p><code class="language-plaintext highlighter-rouge">Transaction</code> objects are created from a default state (<code class="language-plaintext highlighter-rouge">createTransaction</code>), that will then be updated according to the flow and inputs of the user.</p>

<p>Everytime the transaction is updated through a patch (<code class="language-plaintext highlighter-rouge">updateTransaction</code>), its parameters will need to be validated to check if transaction can be signed and broadcasted (see <a href="#validating-transactions">Validating Transactions</a>).</p>

<p>In some cases, this transaction will need to be prepared to correctly check status (<code class="language-plaintext highlighter-rouge">prepareTransaction</code>), like fetching the network fees, transforming some parameters, or setting default values, …</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/js-transaction.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Account</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Transaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./types</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">getEstimatedFees</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./js-getFeesForTransaction</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">sameFees</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="o">!</span><span class="nx">a</span> <span class="o">||</span> <span class="o">!</span><span class="nx">b</span> <span class="p">?</span> <span class="nx">a</span> <span class="o">===</span> <span class="nx">b</span> <span class="p">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="nx">b</span><span class="p">));</span>

<span class="cm">/**
 * Create an empty transaction
 *
 * @returns {Transaction}
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">createTransaction</span> <span class="o">=</span> <span class="p">():</span> <span class="nx">Transaction</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">family</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mycoin</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">send</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">amount</span><span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
  <span class="na">recipient</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span>
  <span class="na">useAllAmount</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">fees</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="p">});</span>

<span class="cm">/**
 * Apply patch to transaction
 *
 * @param {*} t
 * @param {*} patch
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">updateTransaction</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">t</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">,</span>
  <span class="nx">patch</span><span class="p">:</span> <span class="nx">$Shape</span><span class="o">&lt;</span><span class="nx">Transaction</span><span class="o">&gt;</span>
<span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="p">...</span><span class="nx">t</span><span class="p">,</span> <span class="p">...</span><span class="nx">patch</span> <span class="p">});</span>

<span class="cm">/**
 * Prepare transaction before checking status
 *
 * @param {Account} a
 * @param {Transaction} t
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">prepareTransaction</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">a</span><span class="p">:</span> <span class="nx">Account</span><span class="p">,</span> <span class="nx">t</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">fees</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">fees</span><span class="p">;</span>

  <span class="nx">fees</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getEstimatedFees</span><span class="p">({</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">t</span> <span class="p">});</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">sameFees</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">fees</span><span class="p">,</span> <span class="nx">fees</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span> <span class="p">...</span><span class="nx">t</span><span class="p">,</span> <span class="nx">fees</span> <span class="p">};</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">t</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="validating-transactions">Validating Transactions</h4>

<p>We absolutely want to avoid users to sign transactions that do not meet the blockchain’s requirements, and would be rejected - or worse - fail, risking them to loose funds.</p>

<p>Hence, we will validate every parameters that could lead to invalid transactions:</p>

<p>For instance we will check that:</p>

<ul>
  <li>the recipient is not empty</li>
  <li>the recipient address is valid</li>
  <li>the recipient exists</li>
  <li>user have enough funds for the transaction</li>
  <li>user have enough funds to pay transaction fees</li>
  <li>the amount is strictly positive (avoiding zero sends)</li>
  <li>the minimum balance or existential deposit is respected if relevant</li>
  <li>…</li>
</ul>

<p>This validation is done everytime the user updates the transaction (any input changes) to give himeimmediate and contextual feedback. The status object returned by the <code class="language-plaintext highlighter-rouge">getTransactionStatus</code> follows this definition:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">errors: { [string]: Error }</code>: potential error for each (user) field of the transaction</li>
  <li><code class="language-plaintext highlighter-rouge">warnings: { [string]: Error }</code>: potential warning for each (user) field for a transaction</li>
  <li><code class="language-plaintext highlighter-rouge">estimatedFees: BigNumber</code>: estimated total fees the tx is going to cost (in the mainAccount currency)</li>
  <li><code class="language-plaintext highlighter-rouge">amount: BigNumber</code>: actual amount that the recipient will receive (in account currency)</li>
  <li><code class="language-plaintext highlighter-rouge">totalSpent: BigNumber</code>: total amount that the sender will spend (in account currency)</li>
  <li><code class="language-plaintext highlighter-rouge">recipientIsReadOnly?: boolean</code>: should the recipient be non editable</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">errors</code> and <code class="language-plaintext highlighter-rouge">warnings</code> are key - value (error) objects that would have for each input (in the user perspective) the eventual error or notice that has been detected. To each key then it is expected that an input in Ledger Live Desktop and Mobile will exists to display the error.</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/js-getTransactionStatus.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">NotEnoughBalance</span><span class="p">,</span>
  <span class="nx">RecipientRequired</span><span class="p">,</span>
  <span class="nx">InvalidAddress</span><span class="p">,</span>
  <span class="nx">FeeNotLoaded</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@ledgerhq/errors</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Account</span><span class="p">,</span> <span class="nx">TransactionStatus</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Transaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./types</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">isValidAddress</span><span class="p">,</span> <span class="nx">specificCheck</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./logic</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">MyCoinSpecificError</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./errors</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">getTransactionStatus</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span>
  <span class="nx">a</span><span class="p">:</span> <span class="nx">Account</span><span class="p">,</span>
  <span class="nx">t</span><span class="p">:</span> <span class="nx">Transaction</span>
<span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">TransactionStatus</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">const</span> <span class="nx">warnings</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">const</span> <span class="nx">useAllAmount</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">t</span><span class="p">.</span><span class="nx">useAllAmount</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">fees</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">fees</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FeeNotLoaded</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">estimatedFees</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">fees</span> <span class="o">||</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">totalSpent</span> <span class="o">=</span> <span class="nx">useAllAmount</span>
    <span class="p">?</span> <span class="nx">a</span><span class="p">.</span><span class="nx">balance</span>
    <span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">amount</span><span class="p">).</span><span class="nx">plus</span><span class="p">(</span><span class="nx">estimatedFees</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">useAllAmount</span>
    <span class="p">?</span> <span class="nx">a</span><span class="p">.</span><span class="nx">balance</span><span class="p">.</span><span class="nx">minus</span><span class="p">(</span><span class="nx">estimatedFees</span><span class="p">)</span>
    <span class="p">:</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">amount</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">totalSpent</span><span class="p">.</span><span class="nx">gt</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">balance</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">amount</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NotEnoughBalance</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// If MyCoin needs any specific requirement on amount for instance</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">specificCheck</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">amount</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">amount</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCoinSpecificError</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">t</span><span class="p">.</span><span class="nx">recipient</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">recipient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RecipientRequired</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isValidAddress</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">recipient</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">errors</span><span class="p">.</span><span class="nx">recipient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InvalidAddress</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span>
    <span class="nx">errors</span><span class="p">,</span>
    <span class="nx">warnings</span><span class="p">,</span>
    <span class="nx">estimatedFees</span><span class="p">,</span>
    <span class="nx">amount</span><span class="p">,</span>
    <span class="nx">totalSpent</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">getTransactionStatus</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="dealing-with-logic-and-errors">Dealing with Logic and Errors</h4>

<p>As seen in the previous section, <code class="language-plaintext highlighter-rouge">getTransactionStatus</code> deals with errors in a Transaction, because of a wrong user input not meeting the coin logic.
Those are user-dependent errors handled in the UI for each input displayed, and are expected to happen from time to time - we are not throwing them.</p>

<p>But some errors can occur in a different context, and not be caused by user. Try as much as possible to handle all failing cases and throw coin-specific errors (if not generic error already exist), that you may define in an <code class="language-plaintext highlighter-rouge">errors.js</code> file (for reusablity).</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/errors.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">createCustomErrorClass</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@ledgerhq/errors</span><span class="dl">"</span><span class="p">;</span>

<span class="cm">/**
 * MyCoin error thrown on a specifc check done on a transaction amount
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">MyCoinSpecificError</span> <span class="o">=</span> <span class="nx">createCustomErrorClass</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">MyCoinSpecificError</span><span class="dl">"</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Add all exports to <code class="language-plaintext highlighter-rouge">src/errors.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="k">export</span> <span class="o">*</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./families/mycoin/errors</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<p>Also, to avoid repeating code and facilitate usage of checks and constants, gather all your coin-specific logic functions in a single file (calculations, getters, boolean checks…). This will also ease maintenance, for instance when the blockchain’s logic changes (constants or additional checks added).</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/logic.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Account</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">MAX_AMOUNT</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">;</span>

<span class="cm">/**
 * Returns true if address is a valid md5
 *
 * @param {string} address
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">isValidAddress</span> <span class="o">=</span> <span class="p">(</span><span class="nx">address</span><span class="p">:</span> <span class="nx">string</span><span class="p">):</span> <span class="nx">boolean</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">address</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

  <span class="k">return</span> <span class="o">!!</span><span class="nx">address</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^</span><span class="se">[</span><span class="sr">a-f0-9</span><span class="se">]{32}</span><span class="sr">$/</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**
 * Returns true if transaction amount is less than MAX AMOUNT and &gt; 0
 *
 * @param {BigNumber} amount
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">specificCheck</span> <span class="o">=</span> <span class="p">(</span><span class="nx">amount</span><span class="p">:</span> <span class="nx">BigNumber</span><span class="p">):</span> <span class="nx">boolean</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">amount</span><span class="p">.</span><span class="nx">gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">amount</span><span class="p">.</span><span class="nx">lte</span><span class="p">(</span><span class="nx">MAX_AMOUNT</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**
 * Returns nonce for an account
 *
 * @param {Account} a
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">getNonce</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">:</span> <span class="nx">Account</span><span class="p">):</span> <span class="nx">number</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">lastPendingOp</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">pendingOperations</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

  <span class="kd">const</span> <span class="nx">nonce</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span>
    <span class="nx">a</span><span class="p">.</span><span class="nx">myCoinResources</span><span class="p">?.</span><span class="nx">nonce</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">lastPendingOp</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">lastPendingOp</span><span class="p">.</span><span class="nx">transactionSequenceNumber</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">number</span><span class="dl">"</span>
      <span class="p">?</span> <span class="nx">lastPendingOp</span><span class="p">.</span><span class="nx">transactionSequenceNumber</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="p">:</span> <span class="mi">0</span>
  <span class="p">);</span>

  <span class="k">return</span> <span class="nx">nonce</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="building-and-signing-transaction">Building and Signing transaction</h4>

<p>The <code class="language-plaintext highlighter-rouge">Transaction</code> object is not exactly the transaction in the shape of the blockchain’s protocol (which is generally serialized into a blob of bytes). So for convenience, you may implement a <code class="language-plaintext highlighter-rouge">buildTransaction</code> method to serialized it using MyCoin SDK, that could be reused for instance for estimating fees through the API.</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/js-buildTransaction.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Transaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Account</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">getNonce</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./logic</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">getTransactionParams</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">:</span> <span class="nx">Account</span><span class="p">,</span> <span class="nx">t</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">send</span><span class="dl">"</span><span class="p">:</span>
      <span class="k">return</span> <span class="nx">t</span><span class="p">.</span><span class="nx">useAllAmount</span>
        <span class="p">?</span> <span class="p">{</span>
            <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">transferAll</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">args</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">dest</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">recipient</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">}</span>
        <span class="p">:</span> <span class="p">{</span>
            <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">transfer</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">args</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">dest</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">recipient</span><span class="p">,</span>
              <span class="na">value</span><span class="p">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">amount</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
            <span class="p">},</span>
          <span class="p">};</span>
    <span class="nl">default</span><span class="p">:</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Unknown mode in transaction</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**
 *
 * @param {Account} a
 * @param {Transaction} t
 */</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">buildTransaction</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">a</span><span class="p">:</span> <span class="nx">Account</span><span class="p">,</span> <span class="nx">t</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">address</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">freshAddress</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">getTransactionParams</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">t</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">nonce</span> <span class="o">=</span> <span class="nx">getNonce</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">unsigned</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">address</span><span class="p">,</span>
    <span class="nx">nonce</span><span class="p">,</span>
    <span class="nx">params</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="c1">// Will likely be a call to MyCoin SDK</span>
  <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">unsigned</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">buildTransaction</code> function would return an unsigned transaction blob that would be signed with the MyCoin App on device:</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/js-signOperation.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">rxjs</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">FeeNotLoaded</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@ledgerhq/errors</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Transaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Account</span><span class="p">,</span> <span class="nx">Operation</span><span class="p">,</span> <span class="nx">SignOperationEvent</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">open</span><span class="p">,</span> <span class="nx">close</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../hw</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">encodeOperationId</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../operation</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">MyCoin</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./hw-app-mycoin/MyCoin</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">buildTransaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./js-buildTransaction</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">getNonce</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./logic</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">buildOptimisticOperation</span> <span class="o">=</span> <span class="p">(</span>
  <span class="nx">account</span><span class="p">:</span> <span class="nx">Account</span><span class="p">,</span>
  <span class="nx">transaction</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">,</span>
  <span class="nx">fee</span><span class="p">:</span> <span class="nx">BigNumber</span>
<span class="p">):</span> <span class="nx">Operation</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">type</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">OUT</span><span class="dl">"</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">amount</span><span class="p">).</span><span class="nx">plus</span><span class="p">(</span><span class="nx">fee</span><span class="p">);</span>

  <span class="kd">const</span> <span class="na">operation</span><span class="p">:</span> <span class="nx">$Exact</span><span class="o">&lt;</span><span class="nx">Operation</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">id</span><span class="p">:</span> <span class="nx">encodeOperationId</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="dl">""</span><span class="p">,</span> <span class="nx">type</span><span class="p">),</span>
    <span class="na">hash</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span>
    <span class="nx">type</span><span class="p">,</span>
    <span class="nx">value</span><span class="p">,</span>
    <span class="nx">fee</span><span class="p">,</span>
    <span class="na">blockHash</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="na">blockHeight</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="na">senders</span><span class="p">:</span> <span class="p">[</span><span class="nx">account</span><span class="p">.</span><span class="nx">freshAddress</span><span class="p">],</span>
    <span class="na">recipients</span><span class="p">:</span> <span class="p">[</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">recipient</span><span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">),</span>
    <span class="na">accountId</span><span class="p">:</span> <span class="nx">account</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="na">transactionSequenceNumber</span><span class="p">:</span> <span class="nx">getNonce</span><span class="p">(</span><span class="nx">account</span><span class="p">),</span>
    <span class="na">date</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
    <span class="na">extra</span><span class="p">:</span> <span class="p">{</span> <span class="na">additionalField</span><span class="p">:</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">amount</span> <span class="p">},</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">operation</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**
 * Adds signature to unsigned transaction. Will likely be a call to MyCoin SDK
 */</span>
<span class="kd">const</span> <span class="nx">signTx</span> <span class="o">=</span> <span class="p">(</span><span class="nx">unsigned</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">signature</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">unsigned</span><span class="p">}</span><span class="s2">:</span><span class="p">${</span><span class="nx">signature</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**
 * Sign Transaction with Ledger hardware
 */</span>
<span class="kd">const</span> <span class="nx">signOperation</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">account</span><span class="p">,</span>
  <span class="nx">deviceId</span><span class="p">,</span>
  <span class="nx">transaction</span><span class="p">,</span>
<span class="p">}:</span> <span class="p">{</span>
  <span class="nl">account</span><span class="p">:</span> <span class="nx">Account</span><span class="p">,</span>
  <span class="nx">deviceId</span><span class="p">:</span> <span class="o">*</span><span class="p">,</span>
  <span class="nx">transaction</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">,</span>
<span class="p">}):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">SignOperationEvent</span><span class="o">&gt;</span> <span class="o">=&gt;</span>
  <span class="nx">Observable</span><span class="p">.</span><span class="nx">create</span><span class="p">((</span><span class="nx">o</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">transport</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">open</span><span class="p">(</span><span class="nx">deviceId</span><span class="p">);</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">o</span><span class="p">.</span><span class="nx">next</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">device-signature-requested</span><span class="dl">"</span> <span class="p">});</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">fees</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nx">FeeNotLoaded</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="kd">const</span> <span class="nx">unsigned</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">buildTransaction</span><span class="p">(</span><span class="nx">account</span><span class="p">,</span> <span class="nx">transaction</span><span class="p">);</span>

        <span class="c1">// Sign by device</span>
        <span class="kd">const</span> <span class="nx">myCoin</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCoin</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">myCoin</span><span class="p">.</span><span class="nx">signTransaction</span><span class="p">(</span>
          <span class="nx">account</span><span class="p">.</span><span class="nx">freshAddressPath</span><span class="p">,</span>
          <span class="nx">unsigned</span>
        <span class="p">);</span>

        <span class="kd">const</span> <span class="nx">signed</span> <span class="o">=</span> <span class="nx">signTx</span><span class="p">(</span><span class="nx">unsigned</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">signature</span><span class="p">);</span>

        <span class="nx">o</span><span class="p">.</span><span class="nx">next</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">device-signature-granted</span><span class="dl">"</span> <span class="p">});</span>

        <span class="kd">const</span> <span class="nx">operation</span> <span class="o">=</span> <span class="nx">buildOptimisticOperation</span><span class="p">(</span>
          <span class="nx">account</span><span class="p">,</span>
          <span class="nx">transaction</span><span class="p">,</span>
          <span class="nx">transaction</span><span class="p">.</span><span class="nx">fees</span> <span class="p">??</span> <span class="nx">BigNumber</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">);</span>

        <span class="nx">o</span><span class="p">.</span><span class="nx">next</span><span class="p">({</span>
          <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">signed</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">signedOperation</span><span class="p">:</span> <span class="p">{</span>
            <span class="nx">operation</span><span class="p">,</span>
            <span class="na">signature</span><span class="p">:</span> <span class="nx">signed</span><span class="p">,</span>
            <span class="na">expirationDate</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
          <span class="p">},</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
        <span class="nx">close</span><span class="p">(</span><span class="nx">transport</span><span class="p">,</span> <span class="nx">deviceId</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">main</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span>
      <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">complete</span><span class="p">(),</span>
      <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">o</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">});</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">signOperation</span><span class="p">;</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">signOperation</code> function returns an Observable that will notify its subscriber when the user grated the signature.
It must notify it with the signedOperation, with <code class="language-plaintext highlighter-rouge">signature</code> (generally contains the whole blob to be broadcasted) and <code class="language-plaintext highlighter-rouge">operation</code>.</p>

<p>This operation is an optimistic version of the <code class="language-plaintext highlighter-rouge">Operation</code> that would be displayed in the account history as a “Pending Operation” if the broadcast succeed. This pending operation is important to give feedback to the user, but may also be required for calculate the nonce (if relevant).</p>

<h4 id="broadcast">Broadcast</h4>

<p>Once the transaction is signed, it must be broadcasted to MyCoin network. This is pretty easy if you correctly wrapped your API.</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/js-broadcast.js</code></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Operation</span><span class="p">,</span> <span class="nx">SignedOperation</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">patchOperationWithHash</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../operation</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">submit</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./api</span><span class="dl">"</span><span class="p">;</span>

<span class="cm">/**
 * Broadcast the signed transaction
 * @param {signature: string, operation: string} signedOperation
 */</span>
<span class="kd">const</span> <span class="nx">broadcast</span> <span class="o">=</span> <span class="k">async</span> <span class="p">({</span>
  <span class="na">signedOperation</span><span class="p">:</span> <span class="p">{</span> <span class="nx">signature</span><span class="p">,</span> <span class="nx">operation</span> <span class="p">},</span>
<span class="p">}:</span> <span class="p">{</span>
  <span class="nl">signedOperation</span><span class="p">:</span> <span class="nx">SignedOperation</span><span class="p">,</span>
<span class="p">}):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Operation</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">hash</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">submit</span><span class="p">(</span><span class="nx">signature</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">patchOperationWithHash</span><span class="p">(</span><span class="nx">operation</span><span class="p">,</span> <span class="nx">hash</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">broadcast</span><span class="p">;</span>
</code></pre></div></div>

<p>This function must return the optimistic operation, patched with the <code class="language-plaintext highlighter-rouge">hash</code> generally provided by the network.
Once the operation is synced from MyCoin API, the AccountBridge will remove this optimistic operation from the <code class="language-plaintext highlighter-rouge">pendingOperations</code>.</p>

<p><em>NOTE: when there are some pending operations, synchronization will occur every minutes.</em></p>

<h4 id="estimate-max-spendable">Estimate Max Spendable</h4>

<p>The maximum spendable amount is the total balance in an account that is available to send in a transaction. This amount is specific to MyCoin, so you will need to provide this value depending on the transaction the user want to send.</p>

<p>See <a href="https://support.ledger.com/hc/en-us/articles/360012960679-Maximum-spendable-amount">https://support.ledger.com/hc/en-us/articles/360012960679-Maximum-spendable-amount</a></p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/js-estimateMaxSpendable.js</code></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">AccountLike</span><span class="p">,</span> <span class="nx">Account</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">getMainAccount</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../account</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Transaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./types</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">createTransaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./js-transaction</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">getEstimatedFees</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./js-getFeesForTransaction</span><span class="dl">"</span><span class="p">;</span>

<span class="cm">/**
 * Returns the maximum possible amount for transaction
 *
 * @param {Object} param - the account, parentAccount and transaction
 */</span>
<span class="kd">const</span> <span class="nx">estimateMaxSpendable</span> <span class="o">=</span> <span class="k">async</span> <span class="p">({</span>
  <span class="nx">account</span><span class="p">,</span>
  <span class="nx">parentAccount</span><span class="p">,</span>
  <span class="nx">transaction</span><span class="p">,</span>
<span class="p">}:</span> <span class="p">{</span>
  <span class="nl">account</span><span class="p">:</span> <span class="nx">AccountLike</span><span class="p">,</span>
  <span class="nx">parentAccount</span><span class="p">:</span> <span class="p">?</span><span class="nx">Account</span><span class="p">,</span>
  <span class="nx">transaction</span><span class="p">:</span> <span class="p">?</span><span class="nx">Transaction</span><span class="p">,</span>
<span class="p">}):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">BigNumber</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">getMainAccount</span><span class="p">(</span><span class="nx">account</span><span class="p">,</span> <span class="nx">parentAccount</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">createTransaction</span><span class="p">(),</span>
    <span class="p">...</span><span class="nx">transaction</span><span class="p">,</span>
    <span class="na">amount</span><span class="p">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">spendableBalance</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">fees</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getEstimatedFees</span><span class="p">({</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">t</span> <span class="p">});</span>

  <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">spendableBalance</span><span class="p">.</span><span class="nx">minus</span><span class="p">(</span><span class="nx">fees</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">estimateMaxSpendable</span><span class="p">;</span>
</code></pre></div></div>

<p>Here, we only return the spendableBalance, but without the fees. Since Fee estimation can be used elsewhere (like in the <code class="language-plaintext highlighter-rouge">prepareTransaction</code>), you can put it’s logic in a dedicated <code class="language-plaintext highlighter-rouge">js-getFeesForTransaction.js</code> file. Here is an example for a fee fetched from network from an unsigned transaction (a bit like Polkadot), but you can also have specific calculation, with fee-per-byte value provided by the blockchain.</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/js-getFeesForTransaction.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">BigNumber</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">bignumber.js</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Account</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Transaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./types</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">getFees</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./api</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">buildTransaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./js-buildTransaction</span><span class="dl">"</span><span class="p">;</span>

<span class="cm">/**
 * Fetch the transaction fees for a transaction
 *
 * @param {Account} a
 * @param {Transaction} t
 */</span>
<span class="kd">const</span> <span class="nx">getEstimatedFees</span> <span class="o">=</span> <span class="k">async</span> <span class="p">({</span>
  <span class="nx">a</span><span class="p">,</span>
  <span class="nx">t</span><span class="p">,</span>
<span class="p">}:</span> <span class="p">{</span>
  <span class="nl">a</span><span class="p">:</span> <span class="nx">Account</span><span class="p">,</span>
  <span class="nx">t</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">,</span>
<span class="p">}):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">BigNumber</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">unsigned</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">buildTransaction</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">t</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">fees</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getFees</span><span class="p">(</span><span class="nx">unsigned</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">fees</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">getEstimatedFees</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="testing-send-with-cli">Testing send with CLI</h4>

<p>Before being able to test a <code class="language-plaintext highlighter-rouge">send</code> operation with CLI you will need to bind arguments and infer a transaction from it. Since we defined a “mode” field in the transaction, this will be the only argument that will be necessary to test a send.</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/cli-transaction.js</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="nx">invariant</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">invariant</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">flatMap</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">lodash/flatMap</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Transaction</span><span class="p">,</span> <span class="nx">AccountLike</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mode</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="na">desc</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mode of transaction: send</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">];</span>

<span class="kd">function</span> <span class="nx">inferTransactions</span><span class="p">(</span>
  <span class="nx">transactions</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="p">{</span> <span class="na">account</span><span class="p">:</span> <span class="nx">AccountLike</span><span class="p">,</span> <span class="na">transaction</span><span class="p">:</span> <span class="nx">Transaction</span> <span class="p">}</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">opts</span><span class="p">:</span> <span class="nb">Object</span>
<span class="p">):</span> <span class="nx">Transaction</span><span class="p">[]</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">flatMap</span><span class="p">(</span><span class="nx">transactions</span><span class="p">,</span> <span class="p">({</span> <span class="nx">transaction</span><span class="p">,</span> <span class="nx">account</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">invariant</span><span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">family</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">mycoin</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">mycoin family</span><span class="dl">"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">Account</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">invariant</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">myCoinResources</span><span class="p">,</span> <span class="dl">"</span><span class="s2">unactivated account</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="p">...</span><span class="nx">transaction</span><span class="p">,</span>
      <span class="na">family</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mycoin</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">mode</span><span class="p">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">mode</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">send</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="nx">options</span><span class="p">,</span>
  <span class="nx">inferTransactions</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Of course if <em>MyCoin</em> has more complex transactions, you can add many arguments to CLI. You can also define you own cli commands for any specific data you would like to fetch. See <a href="https://github.com/Ledger-Coin-Integration-team/ledger-live-common/blob/master/src/families/polkadot/cli-transaction.js">Polkadot CLI commands</a>.</p>

<p>Now you can try a <code class="language-plaintext highlighter-rouge">getTransactionStatus</code> or a <code class="language-plaintext highlighter-rouge">send</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ledger-live getTransactionStatus <span class="nt">-c</span> mycoin <span class="nt">-i</span> 0 <span class="nt">--amount</span> 0.002 <span class="nt">--recipient</span> 8b2d58d4a7638e9ce8a0423bff5a2de0

<span class="c"># TRANSACTION</span>
<span class="c"># SEND  0.0002 MYC</span>
<span class="c"># TO 8b2d58d4a7638e9ce8a0423bff5a2de0</span>
<span class="c"># STATUS</span>
<span class="c">#  amount: 0.0002 MYC</span>
<span class="c">#  estimated fees: 0.00157511 MYC</span>
<span class="c">#  total spent: 0.00177511 MYC</span>

ledger-live send <span class="nt">-c</span> mycoin <span class="nt">-i</span> 0 <span class="nt">--amount</span> 0.002 <span class="nt">--recipient</span> 8b2d58d4a7638e9ce8a0423bff5a2de0

<span class="c"># {"type":"device-signature-requested"}</span>
<span class="c"># {"type":"device-signature-granted"}</span>
<span class="c"># {"id":"js:2:mycoin:0a93ac3773d54c77817e46e1007d66e3:-134ad522346bee108fa42a512788494e-OUT","hash":"134ad522346bee108fa42a512788494e","type":"OUT","blockHash":null,"blockHeight":null,"senders":["0a93ac3773d54c77817e46e1007d66e3"],"recipients":["8b2d58d4a7638e9ce8a0423bff5a2de0"],"accountId":"js:2:mycoin:0a93ac3773d54c77817e46e1007d66e3:","transactionSequenceNumber":0,"extra":{"additionalField":"20000"},"date":"2021-03-01T08:59:57.445Z","value":"177511","fee":"157511"}</span>
</code></pre></div></div>

<hr />

<h3 id="currency-bridge">Currency Bridge</h3>

<p>CurrencyBridge offers a generic abstraction (for all crypto currencies) to add accounts with a Ledger device.</p>

<p>It is responsible for scanning accounts for a crypto family, but also preloading any data needed for the integration to work.</p>

<p><img src="../images/currency-bridge-flow.png" alt="currency bridge flow" /></p>

<h4 id="scanning-accounts">Scanning accounts</h4>

<p>As we have seen <a href="#synchronization">Synchronization</a>, the <code class="language-plaintext highlighter-rouge">scanAccounts</code>, which is part of the CurrencyBridge, share common logic with the sync function, that’s why we preferably put them in a <code class="language-plaintext highlighter-rouge">js-synchronisation.js</code> file.</p>

<p>The <code class="language-plaintext highlighter-rouge">makeScanAccounts</code> helper will automatically execute the default address derivation logic, but for some reason if you need to have a completely new way to scan account, you could then implement your own strategy.</p>

<h4 id="preload-currency-data-optional">Preload currency data (optional)</h4>

<p>Before creating or using a currency bridge (e.g. scanning accounts, or every 2 minutes for synchronization), Ledger Live will try to preload some currency data (e.g. tokens, delegators,…) required for live-common feature to correctly work.</p>

<p>This preloaded data will be stored in a persisted cache for future use, for Ledger Live to still work if temporarily offline, and speed up startup, depending on <code class="language-plaintext highlighter-rouge">getPreloadStrategy</code> (<code class="language-plaintext highlighter-rouge">preloadMaxAge</code> determines the data expiration that will trigger a refresh).</p>

<p>This cache contains the JSON serialized response from <code class="language-plaintext highlighter-rouge">preload</code> which is then hydrated through <code class="language-plaintext highlighter-rouge">hydrate</code> (which needs deserialization), directly after preload, or after a boot.</p>

<p>Live-Common features will then be able to reuse those data anywhere (e.g. validating transactions) with <code class="language-plaintext highlighter-rouge">getCurrentMyCoinPreloadData</code>, or by subscribing to <code class="language-plaintext highlighter-rouge">getMyCoinPreloadDataUpdates</code> observable.</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/preload.js</code>:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span><span class="p">,</span> <span class="nx">Subject</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">rxjs</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">log</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@ledgerhq/logs</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">MyCoinPreloadData</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">getPreloadedData</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./api</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">PRELOAD_MAX_AGE</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span> <span class="c1">// 30 minutes</span>

<span class="kd">let</span> <span class="nx">currentPreloadedData</span><span class="p">:</span> <span class="nx">MyCoinPreloadData</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">somePreloadedData</span><span class="p">:</span> <span class="p">{},</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">fromHydratePreloadData</span><span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">mixed</span><span class="p">):</span> <span class="nx">MyCoinPreloadData</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">data</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">object</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">data</span><span class="p">.</span><span class="nx">somePreloadedData</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">object</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">somePreloadedData</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">foo</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">somePreloadedData</span><span class="p">.</span><span class="nx">foo</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">bar</span><span class="dl">"</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">somePreloadedData</span><span class="p">:</span> <span class="p">{</span> <span class="nx">foo</span> <span class="p">},</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">updates</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="o">&lt;</span><span class="nx">MyCoinPreloadData</span><span class="o">&gt;</span><span class="p">();</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">getCurrentMyCoinPreloadData</span><span class="p">():</span> <span class="nx">MyCoinPreloadData</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">currentPreloadedData</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">setMyCoinPreloadData</span><span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">MyCoinPreloadData</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="o">===</span> <span class="nx">currentPreloadedData</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="nx">currentPreloadedData</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>

  <span class="nx">updates</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">getMyCoinPreloadDataUpdates</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">MyCoinPreloadData</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">updates</span><span class="p">.</span><span class="nx">asObservable</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">getPreloadStrategy</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">({</span>
  <span class="na">preloadMaxAge</span><span class="p">:</span> <span class="nx">PRELOAD_MAX_AGE</span><span class="p">,</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">preload</span> <span class="o">=</span> <span class="k">async</span> <span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">MyCoinPreloadData</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">mycoin/preload</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">preloading mycoin data...</span><span class="dl">"</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">somePreloadedData</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getPreloadedData</span><span class="p">();</span>

  <span class="k">return</span> <span class="p">{</span> <span class="nx">somePreloadedData</span> <span class="p">};</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">hydrate</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">mixed</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">hydrated</span> <span class="o">=</span> <span class="nx">fromHydratePreloadData</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

  <span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">mycoin/preload</span><span class="dl">"</span><span class="p">,</span> <span class="s2">`hydrated foo with </span><span class="p">${</span><span class="nx">hydrated</span><span class="p">.</span><span class="nx">somePreloadedData</span><span class="p">.</span><span class="nx">foo</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

  <span class="nx">setMyCoinPreloadData</span><span class="p">(</span><span class="nx">hydrated</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Read more on <a href="https://github.com/LedgerHQ/ledger-live-common/blob/master/docs/CurrencyBridge.md">Currency Bridge documentation</a>.</p>

<h3 id="cache-and-performance">Cache and performance</h3>

<p>It is important to keep in mind that all currencies work independently and that Live Common provides a common framework to synchronize accounts with a polling strategy, and that network connectivity is not always stable and optimal.</p>

<p>Hence, the more cryptocurrencies Ledger Live is using, the more requests and calculations are executed, which can take time.</p>

<p>To avoid making the same requests several times, we recommend using a local cache in your implementation (e.g. fees estimations, some currency data to preload…) in a <code class="language-plaintext highlighter-rouge">src/families/mycoin/cache.js</code> file.</p>

<p>We have a <a href="https://github.com/LedgerHQ/ledger-live-common/blob/master/src/cache.js"><code class="language-plaintext highlighter-rouge">src/cache.js</code></a> helper for creating Least-Recently-Used caches anywhere if needed.</p>

<p>See for example the <a href="https://github.com/LedgerHQ/ledger-live-common/blob/master/src/families/polkadot/cache.js">Polkadot’s cache implementation</a>.</p>

<h3 id="front-end-helpers">Front-End helpers</h3>

<p>Live Common is mainly dedicated to be used by Ledger Live front-ends (Desktop and Mobile), so it also contains utilities for react and displaying crypto-specific data.</p>

<h4 id="device-transaction-fields">Device transaction fields</h4>

<p>When signing a transaction, the user is shown on his device all the parameters of this transaction through multiple screen, that he must check towards the value he entered, and compare with what Ledger Live is presenting.</p>

<p>The list of all displayed fields on device are provided by the <code class="language-plaintext highlighter-rouge">getDeviceTransactionConfig</code> function, which must return all transaction fields for a given transaction.</p>

<p><code class="language-plaintext highlighter-rouge">src/families/mycoin/getDeviceTransactionConfig.js</code>:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// @flow</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">AccountLike</span><span class="p">,</span> <span class="nx">Account</span><span class="p">,</span> <span class="nx">TransactionStatus</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">Transaction</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./types</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">type</span> <span class="p">{</span> <span class="nx">DeviceTransactionField</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../transaction</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">getDeviceTransactionConfig</span><span class="p">({</span>
  <span class="nx">transaction</span><span class="p">,</span>
  <span class="na">status</span><span class="p">:</span> <span class="p">{</span> <span class="nx">estimatedFees</span> <span class="p">},</span>
<span class="p">}:</span> <span class="p">{</span>
  <span class="nl">account</span><span class="p">:</span> <span class="nx">AccountLike</span><span class="p">,</span>
  <span class="nx">parentAccount</span><span class="p">:</span> <span class="p">?</span><span class="nx">Account</span><span class="p">,</span>
  <span class="nx">transaction</span><span class="p">:</span> <span class="nx">Transaction</span><span class="p">,</span>
  <span class="nx">status</span><span class="p">:</span> <span class="nx">TransactionStatus</span><span class="p">,</span>
<span class="p">}):</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">DeviceTransactionField</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">fields</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">useAllAmount</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fields</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">label</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Method</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">value</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Transfer All</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">fields</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">label</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Method</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">value</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Transfer</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">});</span>
    <span class="nx">fields</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">amount</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">label</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Amount</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">estimatedFees</span><span class="p">.</span><span class="nx">isZero</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">fields</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">fees</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">label</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fees</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">fields</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">getDeviceTransactionConfig</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>IMPORTANT NOTE: Since a not-well-informed user could be tricked to sign transaction with wrong recipients, we never show the <code class="language-plaintext highlighter-rouge">destination</code> fields in Ledger Live applications, in order for users to get used to always verify it externally.</strong></p>

<h3 id="react-hooks-optional--advanced">React hooks (optional / advanced)</h3>

<p>If you are adding specific features to Ledger Live (like staking), you may need to access data through React hooks, that could provide common logic reusable for React components.</p>

<p>You are then free to add them in a <code class="language-plaintext highlighter-rouge">src/families/mycoin/react.js</code> file.</p>

<p>See examples like sorting and filtering validators, subscribing to preloaded data observable, or waiting for a transaction to be reflected in account, in the <a href="https://github.com/LedgerHQ/ledger-live-common/blob/master/src/families/polkadot/react.js">Polkadot React hooks</a>,</p>

<h3 id="icon">Icon</h3>

<p>Icons are usually maintained by Ledger’s design team, so you must first check that MyCoin icon is not already added in live-common, in <a href="https://github.com/LedgerHQ/ledger-live-common/tree/master/src/data/icons/svg">src/data/icons/svg</a>. It contains cleaned-up versions of Cryptocurrency Icons from <a href="http://cryptoicons.co/">cryptoicons.co</a>, organized by ticker.</p>

<p>If you need to add your own, they must respect those requirements:</p>
<ul>
  <li>Clean SVG with <strong>only</strong> <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> elements representing the crypto</li>
  <li>Size and viewport must be <code class="language-plaintext highlighter-rouge">24x24</code></li>
  <li>Icon should be about <code class="language-plaintext highlighter-rouge">18x18</code> and centered / padded</li>
  <li>flat-styled, and must respect crypto color scheme (filled)</li>
  <li>No background or decorative shape added</li>
  <li>No <code class="language-plaintext highlighter-rouge">&lt;g&gt;</code> or <code class="language-plaintext highlighter-rouge">transform</code>, <code class="language-plaintext highlighter-rouge">style</code> attributes…</li>
</ul>

<p>Name should be the coin’s ticker (e.g. <code class="language-plaintext highlighter-rouge">MYC.svg</code>) and must not conflict with an existing coin or token.</p>

<p>When building live-common, a <a href="https://github.com/LedgerHQ/ledger-live-common/blob/master/scripts/buildReactIcons.js">script</a> automatically converts them to React and React Native components.</p>

<h2 id="testing">Testing</h2>

<p>See <a href="./50_live_tests.md">Testing</a></p>

                        
                            <!-- FC
                            <div class="share uk-text-center uk-margin-medium-top">
    
        <a class="uk-link-muted" href="https://twitter.com/intent/tweet?text=Adding *MyCoin* to Live-Common&url=http://localhost:4000/docs/CI/43_live_common/&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter" onclick="window.open(this.href, 'twitter', 'width=550,height=235');return false;"><span data-uk-icon="icon: twitter; ratio: 1.2"></span></a>
    
    
        <a class="uk-link-muted uk-margin-small-left" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fdocs%2FCI%2F43_live_common%2F" rel="nofollow" target="_blank" title="Share on Facebook" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"><span data-uk-icon="icon: facebook; ratio: 1.2"></span></a>
    
</div>
                            -->
                        
                    </div>

                    

                    <hr class="uk-margin-medium">

                    


  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  



                    <div class="uk-margin-large-top">
    <h3>Related Docs</h3>

    
    
    

    <ul class="uk-list link-secondary">
    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    
    </ul>
</div>


                    
                </article>

                <script>
                    // Table of contents scroll to
                    UIkit.scroll('#markdown-toc a', {
                        duration: 400,
                        offset: 120
                    });
                </script>

            </div>

    </div>
</div>


    <div id="offcanvas-docs" data-uk-offcanvas="overlay: true">
    <div class="uk-offcanvas-bar">

        <button class="uk-offcanvas-close" type="button" data-uk-close></button>

        
        <h5 class="uk-margin-top">Getting Started</h5>
        <ul class="uk-nav uk-nav-default doc-nav">
        
          
          
          <li class=""><a href="/docs/TMPL/installation/">Theme installation</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/setup/">Basic theme setup</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/navigation/">Navigation bar</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/footer/">Footer options</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/posts/">Creating your first post in Jekyll</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/docs/">Creating docs posts</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/comments/">Enabling comments (via Disqus)</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/analytics/">Google Analytics</a></li>
        
        </ul>
        
        <h5 class="uk-margin-top">Theme Features</h5>
        <ul class="uk-nav uk-nav-default doc-nav">
        
          
          
          <li class=""><a href="/docs/TMPL/hero/">Hero page header</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/boxes/">Category boxes section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/featured/">Fearured docs section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/videos/">Video lightbox boxes section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/faq/">Frequently asked questions section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/team/">Team members section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/cta/">Call to action section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/changelog/">Creating a changelog</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/contact/">Contact form (via FormSpree)</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/media/">Adding media to post and doc content</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/toc/">Adding table of contents to docs</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/alerts/">Adding alerts to content</a></li>
        
        </ul>
        
        <h5 class="uk-margin-top">Customization</h5>
        <ul class="uk-nav uk-nav-default doc-nav">
        
          
          
          <li class=""><a href="/docs/TMPL/translation/">Translation</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/customize/">Customization</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/development/">Development</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/sources/">Sources and credits</a></li>
        
        </ul>
        
        <h5 class="uk-margin-top">Help</h5>
        <ul class="uk-nav uk-nav-default doc-nav">
        
          
          
          <li class=""><a href="/docs/TMPL/support/">Contacting support</a></li>
        
        </ul>
        

    </div>
</div>


    <div id="offcanvas" data-uk-offcanvas="flip: true; overlay: true">
    <div class="uk-offcanvas-bar">

        <a class="uk-logo uk-margin-small-bottom" href="/">Ledger Developer pages</a>
     
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
      
        <ul class="uk-nav uk-nav-primary uk-margin-top">
            
                

                

                
                    <li><a href="/" >Home</a></li>
                
            
                

                

                
                    <li><a href="/docs/TMPL/installation" >Docs</a></li>
                
            
                

                

                
                    <li><a href="/blog/" >Blog</a></li>
                
            
                

                

                
                    <li><a href="/changelog-timeline/" >Changelog</a></li>
                
            
                

                

                
                    <li><div class="uk-navbar-item"><a class="uk-button uk-button-success" href="/contact/" >Contact</a></div></li>
                
            
        </ul>

        <div class="uk-margin-top uk-text-center">
            <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex-center uk-grid">
                
<div class="uk-first-column">
    <a href="https://twitter.com/" data-uk-icon="icon: twitter" class="uk-icon-link uk-icon" target="_blank"></a>
</div>


<div>
    <a href="https://www.facebook.com/" data-uk-icon="icon: facebook" class="uk-icon-link uk-icon" target="_blank"></a>
</div>




<div>
    <a href="https://www.instagram.com/" data-uk-icon="icon: instagram" class="uk-icon-link uk-icon" target="_blank"></a>
</div>





<div>
    <a href="https://vimeo.com/" data-uk-icon="icon: vimeo" class="uk-icon-link uk-icon" target="_blank"></a>
</div>






            </div>
        </div>

    </div>
</div>


    
        <footer class="uk-section uk-text-center uk-text-muted">
    <div class="uk-container uk-container-small">

        <div>
            <ul class="uk-subnav uk-flex-center">
                
                    
                    
                    
                        <li><a href="/" >Home</a></li>
                    
                
                    
                    
                    
                        <li><a href="/blog/" >Blog</a></li>
                    
                
                    
                    
                    
                        <li><a href="/contact/" >Contact</a></li>
                    
                
            </ul>
        </div>
        <div class="uk-margin-medium">
            <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex-center uk-grid">
                
                
<div class="uk-first-column">
    <a href="https://twitter.com/" data-uk-icon="icon: twitter" class="uk-icon-link uk-icon" target="_blank"></a>
</div>


<div>
    <a href="https://www.facebook.com/" data-uk-icon="icon: facebook" class="uk-icon-link uk-icon" target="_blank"></a>
</div>




<div>
    <a href="https://www.instagram.com/" data-uk-icon="icon: instagram" class="uk-icon-link uk-icon" target="_blank"></a>
</div>





<div>
    <a href="https://vimeo.com/" data-uk-icon="icon: vimeo" class="uk-icon-link uk-icon" target="_blank"></a>
</div>






                
            </div>
        </div>
        <div class="uk-margin-medium uk-text-small copyright link-secondary">Made by <a href="https://ledger.com/">Ledger</a> France</div>

    </div>
</footer>

    

    

    

    </body>

</html>
