<!DOCTYPE html>
<html lang="en">

    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Emulating devices with Speculos | Ledger Developer pages</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Emulating devices with Speculos" />
<meta name="author" content="pscott" />
<meta property="og:locale" content="en" />
<meta name="description" content="Sections in this article Introduction Setup Usage Communicating with the device Debugging with GDB Debugging inside Visual Studio Code Introduction Ledger has developed its own Ledger Nano S / Ledger Nano X / Ledger Blue emulator, called Speculos. This emulator can be useful if you want to run tests, debug your app with GDB, or just try your app without having to physically plug-in your Ledger device. We will go over a quick guide to using speculos, but more information is available in speculos dedicated documentation or in the docs section of the github page. Setup Start by cloning the official Speculos repo: git clone https://github.com/LedgerHQ/speculos Make sure you have the appropriate packages installed on your machine: sudo apt install qemu-user-static python3-pyqt5 python3-construct python3-jsonschema python3-mnemonic python3-pyelftools gcc-arm-linux-gnueabihf libc6-dev-armhf-cross gdb-multiarch Build: cmake -Bbuild -H. make -C build/ Please note that the first build can take some time because a tarball of OpenSSL is downloaded (the integrity of the downloaded tarball is checked) before being built. Further invocations of make skip this step. The following command line can be used for a debug build: cmake -Bbuild -DCMAKE_BUILD_TYPE=Debug -H. Usage Warning Only run Speculos on trusted apps, as a malicious app could exploit it and make arbitrary Linux system calls. To run your application, simply type in: ./speculos.py /path/to/app.elf You can then use your left / right arrows to emulate the left and right buttons of your device. Communicating with the device You can communicate with the emulated device using APDUs. Speculos embbeds a TCP server (listening on 127.0.0.1:9999) to forwards APDUs to the target app. In this example we will use the ledgerctl client that you can install with pip: pip3 install ledgerwallet If the environment variables LEDGER_PROXY_ADDRESS and LEDGER_PROXY_PORT are set, the library ill try to use the device emulated by Speculos. For instance, the following command-line sends the APDU e0 c4 00 00 00 (Bitcoin-app’s APDU to request the version): $ ./speculos.py /path/to/app.elf &amp; ## First start the app in the background $ echo &#39;e0c4000000&#39; | LEDGER_PROXY_ADDRESS=127.0.0.1 LEDGER_PROXY_PORT=9999 ledgerctl send - 10:01:09.546:apdu: &gt; e0c4000000 10:01:09.547:apdu: &lt; 6d00 6d00 Other clients are available (ledgerblue, btchip-python…) and you will find more information in speculos’ doc. Debugging with GDB Speculos can also be used to debug your code with GDB: ./speculos.py -d /path/to/app.elf &amp; ./tools/debug.sh /path/to/app.elf This command should start a brand new gdb instance with your app already loaded ! Debugging inside Visual Studio Code Visual Studio Code users might be happy to learn that debugging through the usual VSCode interface is made possible using speculos. In your .vscode file, simply create a launch.json file containing this: { &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [ { &quot;type&quot;: &quot;gdb&quot;, &quot;request&quot;: &quot;attach&quot;, &quot;name&quot;: &quot;Attach to gdbserver&quot;, &quot;executable&quot;: &quot;${workspaceFolder}/bin/app.elf&quot;, &quot;target&quot;: &quot;:1234&quot;, &quot;remote&quot;: true, &quot;cwd&quot;: &quot;${workspaceFolder}&quot;, &quot;valuesFormatting&quot;: &quot;parseText&quot;, &quot;gdbpath&quot;: &quot;gdb-multiarch&quot;, &quot;autorun&quot;: [ &quot;set architecture arm&quot;, &quot;handle SIGILL nostop pass noprint&quot;, &quot;add-symbol-file ${workspaceFolder}/bin/app.elf 0x40000000&quot;, &quot;b *0x40000000&quot;, &quot;c&quot; ] } ] } Make sure you have Native Debug’s extension installed. Then, follow these steps: Set a breakpoint (click on the left-hand side of the line you want to set a breakpoint on). In a new terminal, attach speculos (run ./speculos.py -d /path/to/app.elf). In VSCode, press F5 to start the debugging session. You’re good to go ! If your device is in a loop (if you get the error Cannot execute this command while the selected thread is running), then you probably need to send an APDU to the device to actually reach the breakpoint you’ve set. Please refer to the Communicating with the device section." />
<meta property="og:description" content="Sections in this article Introduction Setup Usage Communicating with the device Debugging with GDB Debugging inside Visual Studio Code Introduction Ledger has developed its own Ledger Nano S / Ledger Nano X / Ledger Blue emulator, called Speculos. This emulator can be useful if you want to run tests, debug your app with GDB, or just try your app without having to physically plug-in your Ledger device. We will go over a quick guide to using speculos, but more information is available in speculos dedicated documentation or in the docs section of the github page. Setup Start by cloning the official Speculos repo: git clone https://github.com/LedgerHQ/speculos Make sure you have the appropriate packages installed on your machine: sudo apt install qemu-user-static python3-pyqt5 python3-construct python3-jsonschema python3-mnemonic python3-pyelftools gcc-arm-linux-gnueabihf libc6-dev-armhf-cross gdb-multiarch Build: cmake -Bbuild -H. make -C build/ Please note that the first build can take some time because a tarball of OpenSSL is downloaded (the integrity of the downloaded tarball is checked) before being built. Further invocations of make skip this step. The following command line can be used for a debug build: cmake -Bbuild -DCMAKE_BUILD_TYPE=Debug -H. Usage Warning Only run Speculos on trusted apps, as a malicious app could exploit it and make arbitrary Linux system calls. To run your application, simply type in: ./speculos.py /path/to/app.elf You can then use your left / right arrows to emulate the left and right buttons of your device. Communicating with the device You can communicate with the emulated device using APDUs. Speculos embbeds a TCP server (listening on 127.0.0.1:9999) to forwards APDUs to the target app. In this example we will use the ledgerctl client that you can install with pip: pip3 install ledgerwallet If the environment variables LEDGER_PROXY_ADDRESS and LEDGER_PROXY_PORT are set, the library ill try to use the device emulated by Speculos. For instance, the following command-line sends the APDU e0 c4 00 00 00 (Bitcoin-app’s APDU to request the version): $ ./speculos.py /path/to/app.elf &amp; ## First start the app in the background $ echo &#39;e0c4000000&#39; | LEDGER_PROXY_ADDRESS=127.0.0.1 LEDGER_PROXY_PORT=9999 ledgerctl send - 10:01:09.546:apdu: &gt; e0c4000000 10:01:09.547:apdu: &lt; 6d00 6d00 Other clients are available (ledgerblue, btchip-python…) and you will find more information in speculos’ doc. Debugging with GDB Speculos can also be used to debug your code with GDB: ./speculos.py -d /path/to/app.elf &amp; ./tools/debug.sh /path/to/app.elf This command should start a brand new gdb instance with your app already loaded ! Debugging inside Visual Studio Code Visual Studio Code users might be happy to learn that debugging through the usual VSCode interface is made possible using speculos. In your .vscode file, simply create a launch.json file containing this: { &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [ { &quot;type&quot;: &quot;gdb&quot;, &quot;request&quot;: &quot;attach&quot;, &quot;name&quot;: &quot;Attach to gdbserver&quot;, &quot;executable&quot;: &quot;${workspaceFolder}/bin/app.elf&quot;, &quot;target&quot;: &quot;:1234&quot;, &quot;remote&quot;: true, &quot;cwd&quot;: &quot;${workspaceFolder}&quot;, &quot;valuesFormatting&quot;: &quot;parseText&quot;, &quot;gdbpath&quot;: &quot;gdb-multiarch&quot;, &quot;autorun&quot;: [ &quot;set architecture arm&quot;, &quot;handle SIGILL nostop pass noprint&quot;, &quot;add-symbol-file ${workspaceFolder}/bin/app.elf 0x40000000&quot;, &quot;b *0x40000000&quot;, &quot;c&quot; ] } ] } Make sure you have Native Debug’s extension installed. Then, follow these steps: Set a breakpoint (click on the left-hand side of the line you want to set a breakpoint on). In a new terminal, attach speculos (run ./speculos.py -d /path/to/app.elf). In VSCode, press F5 to start the debugging session. You’re good to go ! If your device is in a loop (if you get the error Cannot execute this command while the selected thread is running), then you probably need to send an APDU to the device to actually reach the breakpoint you’ve set. Please refer to the Communicating with the device section." />
<link rel="canonical" href="http://localhost:4000/docs/NA/u_speculos/" />
<meta property="og:url" content="http://localhost:4000/docs/NA/u_speculos/" />
<meta property="og:site_name" content="Ledger Developer pages" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-22T15:38:24+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Emulating devices with Speculos" />
<script type="application/ld+json">
{"datePublished":"2021-04-22T15:38:24+02:00","description":"Sections in this article Introduction Setup Usage Communicating with the device Debugging with GDB Debugging inside Visual Studio Code Introduction Ledger has developed its own Ledger Nano S / Ledger Nano X / Ledger Blue emulator, called Speculos. This emulator can be useful if you want to run tests, debug your app with GDB, or just try your app without having to physically plug-in your Ledger device. We will go over a quick guide to using speculos, but more information is available in speculos dedicated documentation or in the docs section of the github page. Setup Start by cloning the official Speculos repo: git clone https://github.com/LedgerHQ/speculos Make sure you have the appropriate packages installed on your machine: sudo apt install qemu-user-static python3-pyqt5 python3-construct python3-jsonschema python3-mnemonic python3-pyelftools gcc-arm-linux-gnueabihf libc6-dev-armhf-cross gdb-multiarch Build: cmake -Bbuild -H. make -C build/ Please note that the first build can take some time because a tarball of OpenSSL is downloaded (the integrity of the downloaded tarball is checked) before being built. Further invocations of make skip this step. The following command line can be used for a debug build: cmake -Bbuild -DCMAKE_BUILD_TYPE=Debug -H. Usage Warning Only run Speculos on trusted apps, as a malicious app could exploit it and make arbitrary Linux system calls. To run your application, simply type in: ./speculos.py /path/to/app.elf You can then use your left / right arrows to emulate the left and right buttons of your device. Communicating with the device You can communicate with the emulated device using APDUs. Speculos embbeds a TCP server (listening on 127.0.0.1:9999) to forwards APDUs to the target app. In this example we will use the ledgerctl client that you can install with pip: pip3 install ledgerwallet If the environment variables LEDGER_PROXY_ADDRESS and LEDGER_PROXY_PORT are set, the library ill try to use the device emulated by Speculos. For instance, the following command-line sends the APDU e0 c4 00 00 00 (Bitcoin-app’s APDU to request the version): $ ./speculos.py /path/to/app.elf &amp; ## First start the app in the background $ echo &#39;e0c4000000&#39; | LEDGER_PROXY_ADDRESS=127.0.0.1 LEDGER_PROXY_PORT=9999 ledgerctl send - 10:01:09.546:apdu: &gt; e0c4000000 10:01:09.547:apdu: &lt; 6d00 6d00 Other clients are available (ledgerblue, btchip-python…) and you will find more information in speculos’ doc. Debugging with GDB Speculos can also be used to debug your code with GDB: ./speculos.py -d /path/to/app.elf &amp; ./tools/debug.sh /path/to/app.elf This command should start a brand new gdb instance with your app already loaded ! Debugging inside Visual Studio Code Visual Studio Code users might be happy to learn that debugging through the usual VSCode interface is made possible using speculos. In your .vscode file, simply create a launch.json file containing this: { &quot;version&quot;: &quot;0.2.0&quot;, &quot;configurations&quot;: [ { &quot;type&quot;: &quot;gdb&quot;, &quot;request&quot;: &quot;attach&quot;, &quot;name&quot;: &quot;Attach to gdbserver&quot;, &quot;executable&quot;: &quot;${workspaceFolder}/bin/app.elf&quot;, &quot;target&quot;: &quot;:1234&quot;, &quot;remote&quot;: true, &quot;cwd&quot;: &quot;${workspaceFolder}&quot;, &quot;valuesFormatting&quot;: &quot;parseText&quot;, &quot;gdbpath&quot;: &quot;gdb-multiarch&quot;, &quot;autorun&quot;: [ &quot;set architecture arm&quot;, &quot;handle SIGILL nostop pass noprint&quot;, &quot;add-symbol-file ${workspaceFolder}/bin/app.elf 0x40000000&quot;, &quot;b *0x40000000&quot;, &quot;c&quot; ] } ] } Make sure you have Native Debug’s extension installed. Then, follow these steps: Set a breakpoint (click on the left-hand side of the line you want to set a breakpoint on). In a new terminal, attach speculos (run ./speculos.py -d /path/to/app.elf). In VSCode, press F5 to start the debugging session. You’re good to go ! If your device is in a loop (if you get the error Cannot execute this command while the selected thread is running), then you probably need to send an APDU to the device to actually reach the breakpoint you’ve set. Please refer to the Communicating with the device section.","dateModified":"2021-04-22T15:38:24+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/docs/NA/u_speculos/"},"url":"http://localhost:4000/docs/NA/u_speculos/","author":{"@type":"Person","name":"pscott"},"@type":"BlogPosting","headline":"Emulating devices with Speculos","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta property="og:image" content="http://localhost:4000/uploads/"/>
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="shortcut icon" type="image/png" href="/uploads/favicon.png" >
  <link rel="alternate" type="application/rss+xml" title="Ledger Developer pages" href="/feed.xml">
  <script src="/assets/js/main.js"></script>
  
    <script>
function searchResults(form) {

    var currentItem = null;
    var search = document.getElementById(form);
    var results = document.getElementById(form + "-results");
    var toggle = document.getElementById(form + "-toggle");

    function removeActive() {
        for (i = 0; i < results.children.length; i++) {
            results.children[i].classList.remove("uk-background-muted");
        }
    }

    // Detect all clicks on the document
    document.addEventListener("click", function(event) {

        var isClickSearch = false;
        var isClickResults = false;
        var isClickSearchToggle = false;

        if (search !== null) {
            isClickSearch = search.contains(event.target);
        }

        if (results !== null) {
            isClickResults = results.contains(event.target);
        }

        if (toggle !== null) {
            isClickSearchToggle = toggle.contains(event.target);
        }

        if (isClickSearch || isClickSearchToggle) {
            results.style.display = "block";
        }        

        if (!isClickResults && !isClickSearch && !isClickSearchToggle) {
            results.style.display = "none";
        }        
        
    });    

    results.addEventListener("mouseover", function(event) {

        removeActive();
        event.target.parentElement.classList.add("uk-background-muted");
        currentItem = null;

    });

    results.addEventListener("mouseout", function(event) {
        event.target.parentElement.classList.remove("uk-background-muted");
    });


    search.addEventListener("keyup", function(event) {

        var resultItems = results.children;
        var resultCount = results.children.length;
                                
        if (event.keyCode === 40) {

            if (currentItem < (resultCount - 1)) {
                if (currentItem === null) {
                    currentItem = 0;
                } else {
                    removeActive();
                    currentItem++;
                }
                removeActive();
                resultItems[currentItem].classList.add("uk-background-muted");
            }
            
        } else if (event.keyCode === 38) {

            if (currentItem > 0) {
                if (currentItem === null) {
                    currentItem = 0;
                } else {
                    removeActive();
                    currentItem--;
                }
                removeActive();
                resultItems[currentItem].classList.add("uk-background-muted");
            }

        } else if (event.keyCode === 13) {

            resultItems[currentItem].children[0].click();

        }

    });

}
</script>
  
  
  
<script src="http://127.0.0.1:35729/livereload.js"></script></head>

    <body>

    
        <div data-uk-sticky="animation: uk-animation-slide-top; sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky; cls-inactive: uk-navbar-transparent; top: 200">
    <nav class="uk-navbar-container">
        <div class="uk-container">
            <div data-uk-navbar>
                <div class="uk-navbar-left">
                    <a class="uk-navbar-item uk-logo uk-visible@m" href="/">Ledger Developer pages</a>
                    
                        <a class="uk-navbar-toggle uk-hidden@m" href="#offcanvas-docs" data-uk-toggle><span data-uk-navbar-toggle-icon></span> <span class="uk-margin-small-left">Docs</span></a>
                    

                    <ul class="uk-navbar-nav uk-visible@m">
                        
                            
                            
                            
                                
                                    
                                        <li><a href="/docs/00_header/" >Creating content</a></li>
                                                                                                        
                                
                            
                        
                            
                            
                            
                                
                                    
                                        <li><a href="/docs/00_header/" >Tools & Frameworks</a></li>
                                                                                                        
                                
                            
                        
                            
                            
                            
                                
                                    
                                        <li><a href="/docs/00_header/" >Release notes</a></li>
                                                                                                        
                                
                            
                        
                            
                            
                            
                                
                                    
                                        <li><a href="/docs/00_header/" >Tutorials</a></li>
                                                                                                        
                                
                            
                        
                            
                            
                            
                                
                                    
                                        <li><a href="#">_Old</a>
                                        
                                            <div class="uk-navbar-dropdown">
                                                <ul class="uk-nav uk-navbar-dropdown-nav">
                                                    
                                                    
                                                        
                                                        
                                                        <li><a href="/docs/TMPL/installation/">Template docs</a></li>
                                                    
                                                    
                                                    
                                                        
                                                        
                                                        <li><a href="/blog/">Blog</a></li>
                                                    
                                                    
                                                    
                                                        <li class="uk-nav-header">Changelogs</li>
                                                    
                                                    
                                                </ul>
                                            </div>
                                        
                                        </li>
                                                                                                        
                                
                            
                        
                    </ul>
                </div>
                <div class="uk-navbar-center uk-hidden@m">
                    <a class="uk-navbar-item uk-logo" href="/">Ledger Developer pages</a>
                </div>
                <div class="uk-navbar-right">
                    
                        
                            <div>
                                <a id="search-navbar-toggle" class="uk-navbar-toggle" uk-search-icon href="#"></a>
                                <div class="uk-drop uk-background-default uk-border-rounded" uk-drop="mode: click; pos: left-center; offset: 0">
                                    <form class="uk-search uk-search-navbar uk-width-1-1" onsubmit="return false;">
                                        <input id="search-navbar" class="uk-search-input" type="search" placeholder="Search for answers" autofocus autocomplete="off">
                                    </form>
                                    <ul id="search-navbar-results" class="uk-position-absolute uk-width-1-1 uk-list"></ul>
                                </div>
                            </div>
                            <script>
                            SimpleJekyllSearch({
                                searchInput: document.getElementById('search-navbar'),
                                resultsContainer: document.getElementById('search-navbar-results'),
                                noResultsText: '<li class="no-results">No results found</li>',
                                searchResultTemplate: '<li><a href="{url}">{title}</a></li>',
                                json: "/search.json"
                            });
                            searchResults("search-navbar");
                            </script>
                        
                    

                    <ul class="uk-navbar-nav uk-visible@m">
                        
                    </ul>

                    
                        <a class="uk-navbar-toggle uk-hidden@m" href="#offcanvas" data-uk-toggle><span data-uk-navbar-toggle-icon></span> <span class="uk-margin-small-left">Menu</span></a>
                    

                </div>
            </div>
        </div>
    </nav>
</div>
    

    <div class="uk-section">
    <div class="uk-container">
        <div class="uk-grid-large" data-uk-grid>

            <div class="sidebar-fixed-width uk-visible@m">
                <div class="sidebar-docs uk-position-fixed uk-margin-top">
                    
                    <h5>Background Information</h5>
                    <ul class="uk-nav uk-nav-default doc-nav">
                    
                      
                      
                      <li class=""><a href="/docs/NA/bg_introduction/">Introduction</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/bg_personal_security_devices/">Personal Security Devices</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/bg_master_seed/">The Master Seed</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/bg_hd_keys/">HD Key Generation</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/bg_hd_use_cases/">Applications for HD Trees</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/bg_application_isolation/">Application Isolation</a></li>
                    
                    </ul>
                    
                    <h5>BOLOS Platform</h5>
                    <ul class="uk-nav uk-nav-default doc-nav">
                    
                      
                      
                      <li class=""><a href="/docs/NA/b_introduction/">Introduction</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/b_overview/">Overview</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/b_features/">BOLOS Features</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/b_hardware_architecture/">Hardware Architecture</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/b_application_environment/">Application Environment</a></li>
                    
                    </ul>
                    
                    <h5>Userspace Development</h5>
                    <ul class="uk-nav uk-nav-default doc-nav">
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_introduction/">Introduction</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_setup/">Setting it up</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_writing_apps/">Writing Apps</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_display_management/">Display Management</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_advanced_display_management/">Advanced display management</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_low_level_display_management/">Low-level display management</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_syscalls/">Interaction Between BOLOS and Apps</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_application_structure/">Application Structure and I/O</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_memory/">Persistent Storage and PIC</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_alignment/">Memory alignment</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_troubleshooting/">Common Pitfalls and Troubleshooting</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/u_debugging/">Application Debug</a></li>
                    
                      
                      
                      <li class="uk-active"><a href="/docs/NA/u_speculos/">Emulating devices with Speculos</a></li>
                    
                    </ul>
                    
                    <h5>Additional Resources</h5>
                    <ul class="uk-nav uk-nav-default doc-nav">
                    
                      
                      
                      <li class=""><a href="/docs/NA/a_publishing_an_app/">Publishing an Application</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/a_external_docs/">External Documentation</a></li>
                    
                      
                      
                      <li class=""><a href="/docs/NA/a_security_guidelines/">Developing Secure Ledger Apps</a></li>
                    
                    </ul>
                    
                </div>
            </div>

            <div class="uk-width-1-1 uk-width-expand@m">

                <article class="uk-article">

                    <h1 class="uk-article-title">Emulating devices with Speculos</h1>

                    <p class="uk-text-lead uk-text-muted">Lovely Spread</p>

                    <div class="uk-article-meta uk-margin-top uk-margin-medium-bottom uk-flex uk-flex-middle">
                        


  
  <img class="uk-border-circle avatar" src="http://localhost:4000/uploads/avatar-pscott.jpg" alt="pscott">


<div>
  
    Written by <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">pscott</span></span><br>
  
  <time datetime="" itemprop="datePublished">
    
    
  </time>
</div>
                    </div>

                    <div class="article-content link-primary">
                        <h4 class="no_toc" id="sections-in-this-article">Sections in this article</h4>
<ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a>    <ul>
      <li><a href="#setup" id="markdown-toc-setup">Setup</a></li>
      <li><a href="#usage" id="markdown-toc-usage">Usage</a></li>
      <li><a href="#communicating-with-the-device" id="markdown-toc-communicating-with-the-device">Communicating with the device</a></li>
      <li><a href="#debugging-with-gdb" id="markdown-toc-debugging-with-gdb">Debugging with GDB</a></li>
      <li><a href="#debugging-inside-visual-studio-code" id="markdown-toc-debugging-inside-visual-studio-code">Debugging inside Visual Studio Code</a></li>
    </ul>
  </li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>Ledger has developed its own Ledger Nano S / Ledger Nano X / Ledger Blue
emulator, called <a href="https://github.com/LedgerHQ/speculos">Speculos</a>. This
emulator can be useful if you want to run tests, debug your app with
GDB, or just try your app without having to physically plug-in your
Ledger device.</p>

<p>We will go over a quick guide to using speculos, but more information is
available in <a href="https://speculos.ledger.com/">speculos dedicated
documentation</a> or in the <a href="https://github.com/LedgerHQ/speculos/tree/master/doc">docs section of
the github page</a>.</p>

<h3 id="setup">Setup</h3>

<ol>
  <li>
    <p>Start by cloning the <a href="https://github.com/LedgerHQ/speculos">official Speculos
repo</a>:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/LedgerHQ/speculos
</code></pre></div>    </div>
  </li>
  <li>
    <p>Make sure you have the appropriate packages installed on your
machine:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install qemu-user-static python3-pyqt5 python3-construct python3-jsonschema python3-mnemonic python3-pyelftools gcc-arm-linux-gnueabihf libc6-dev-armhf-cross gdb-multiarch
</code></pre></div>    </div>
  </li>
  <li>
    <p>Build:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmake -Bbuild -H.
make -C build/
</code></pre></div>    </div>
  </li>
</ol>

<p>Please note that the first build can take some time because a tarball of
OpenSSL is downloaded (the integrity of the downloaded tarball is
checked) before being built. Further invocations of <code class="language-plaintext highlighter-rouge">make</code> skip this
step.</p>

<p>The following command line can be used for a debug build:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmake -Bbuild -DCMAKE_BUILD_TYPE=Debug -H.
</code></pre></div></div>

<h3 id="usage">Usage</h3>

<div class="warning">

<div class="title">

Warning

</div>

Only run Speculos on trusted apps, as a malicious app could exploit it
and make arbitrary Linux system calls.

</div>

<p>To run your application, simply type in:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./speculos.py /path/to/app.elf
</code></pre></div></div>

<p>You can then use your left / right arrows to emulate the left and right
buttons of your device.</p>

<h3 id="communicating-with-the-device">Communicating with the device</h3>

<p>You can communicate with the emulated device using
<a href="https://en.wikipedia.org/wiki/Smart_card_application_protocol_data_unit">APDUs</a>.
Speculos embbeds a TCP server (listening on <code class="language-plaintext highlighter-rouge">127.0.0.1:9999</code>) to
forwards APDUs to the target app.</p>

<p>In this example we will use the
<a href="https://github.com/LedgerHQ/ledgerctl">ledgerctl</a> client that you can
install with <code class="language-plaintext highlighter-rouge">pip</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 install ledgerwallet
</code></pre></div></div>

<p>If the environment variables <code class="language-plaintext highlighter-rouge">LEDGER_PROXY_ADDRESS</code> and
<code class="language-plaintext highlighter-rouge">LEDGER_PROXY_PORT</code> are set, the library ill try to use the device
emulated by Speculos. For instance, the following command-line sends the
APDU <code class="language-plaintext highlighter-rouge">e0 c4 00 00 00</code> (Bitcoin-app’s APDU to request the version):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./speculos.py /path/to/app.elf &amp;  ## First start the app in the background
$ echo 'e0c4000000' | LEDGER_PROXY_ADDRESS=127.0.0.1 LEDGER_PROXY_PORT=9999 ledgerctl send -
10:01:09.546:apdu: &gt; e0c4000000
10:01:09.547:apdu: &lt; 6d00
6d00
</code></pre></div></div>

<p>Other clients are available (ledgerblue, btchip-python…) and you will
find more information in <a href="https://github.com/LedgerHQ/speculos/blob/master/doc/usage.md#clients">speculos’
doc</a>.</p>

<h3 id="debugging-with-gdb">Debugging with GDB</h3>

<p>Speculos can also be used to debug your code with GDB:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./speculos.py -d /path/to/app.elf &amp;
./tools/debug.sh /path/to/app.elf
</code></pre></div></div>

<p>This command should start a brand new gdb instance with your app already
loaded !</p>

<h3 id="debugging-inside-visual-studio-code">Debugging inside Visual Studio Code</h3>

<p>Visual Studio Code users might be happy to learn that debugging through
the usual VSCode interface is made possible using speculos.</p>

<p>In your <code class="language-plaintext highlighter-rouge">.vscode</code> file, simply create a <code class="language-plaintext highlighter-rouge">launch.json</code> file containing
this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "version": "0.2.0",
    "configurations": [
        {
            "type": "gdb",
            "request": "attach",
            "name": "Attach to gdbserver",
            "executable": "${workspaceFolder}/bin/app.elf",
            "target": ":1234",
            "remote": true,
            "cwd": "${workspaceFolder}",
            "valuesFormatting": "parseText",
            "gdbpath": "gdb-multiarch",
            "autorun": [
                "set architecture arm",
                "handle SIGILL nostop pass noprint",
                "add-symbol-file ${workspaceFolder}/bin/app.elf 0x40000000",
                "b *0x40000000",
                "c"
            ]
        }
    ]
}
</code></pre></div></div>

<p>Make sure you have <a href="https://marketplace.visualstudio.com/items?itemName=webfreak.debug">Native Debug’s
extension</a>
installed. Then, follow these steps:</p>

<ol>
  <li>Set a breakpoint (click on the left-hand side of the line you want
to set a breakpoint on).</li>
  <li>In a new terminal, attach speculos (run
<code class="language-plaintext highlighter-rouge">./speculos.py -d /path/to/app.elf</code>).</li>
  <li>In VSCode, press F5 to start the debugging session. You’re good to
go !</li>
</ol>

<p>If your device is in a loop (if you get the error
<code class="language-plaintext highlighter-rouge">Cannot execute this command while the selected thread is running</code>),
then you probably need to send an APDU to the device to actually reach
the breakpoint you’ve set. Please refer to the <a href="#communicating-with-the-device">Communicating with the
device</a> section.</p>


                        
                            <!-- FC
                            <div class="share uk-text-center uk-margin-medium-top">
    
        <a class="uk-link-muted" href="https://twitter.com/intent/tweet?text=Emulating devices with Speculos&url=http://localhost:4000/docs/NA/u_speculos/&via=&related=" rel="nofollow" target="_blank" title="Share on Twitter" onclick="window.open(this.href, 'twitter', 'width=550,height=235');return false;"><span data-uk-icon="icon: twitter; ratio: 1.2"></span></a>
    
    
        <a class="uk-link-muted uk-margin-small-left" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fdocs%2FNA%2Fu_speculos%2F" rel="nofollow" target="_blank" title="Share on Facebook" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"><span data-uk-icon="icon: facebook; ratio: 1.2"></span></a>
    
</div>
                            -->
                        
                    </div>

                    

                    <hr class="uk-margin-medium">

                    


  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  



                    <div class="uk-margin-large-top">
    <h3>Related Docs</h3>

    
    
    

    <ul class="uk-list link-secondary">
    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    

    
    

    

    

    
    </ul>
</div>


                    
                </article>

                <script>
                    // Table of contents scroll to
                    UIkit.scroll('#markdown-toc a', {
                        duration: 400,
                        offset: 120
                    });
                </script>

            </div>

    </div>
</div>


    <div id="offcanvas-docs" data-uk-offcanvas="overlay: true">
    <div class="uk-offcanvas-bar">

        <button class="uk-offcanvas-close" type="button" data-uk-close></button>

        
        <h5 class="uk-margin-top">Getting Started</h5>
        <ul class="uk-nav uk-nav-default doc-nav">
        
          
          
          <li class=""><a href="/docs/TMPL/installation/">Theme installation</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/setup/">Basic theme setup</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/navigation/">Navigation bar</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/footer/">Footer options</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/posts/">Creating your first post in Jekyll</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/docs/">Creating docs posts</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/comments/">Enabling comments (via Disqus)</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/analytics/">Google Analytics</a></li>
        
        </ul>
        
        <h5 class="uk-margin-top">Theme Features</h5>
        <ul class="uk-nav uk-nav-default doc-nav">
        
          
          
          <li class=""><a href="/docs/TMPL/hero/">Hero page header</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/boxes/">Category boxes section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/featured/">Fearured docs section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/videos/">Video lightbox boxes section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/faq/">Frequently asked questions section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/team/">Team members section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/cta/">Call to action section</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/changelog/">Creating a changelog</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/contact/">Contact form (via FormSpree)</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/media/">Adding media to post and doc content</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/toc/">Adding table of contents to docs</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/alerts/">Adding alerts to content</a></li>
        
        </ul>
        
        <h5 class="uk-margin-top">Customization</h5>
        <ul class="uk-nav uk-nav-default doc-nav">
        
          
          
          <li class=""><a href="/docs/TMPL/translation/">Translation</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/customize/">Customization</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/development/">Development</a></li>
        
          
          
          <li class=""><a href="/docs/TMPL/sources/">Sources and credits</a></li>
        
        </ul>
        
        <h5 class="uk-margin-top">Help</h5>
        <ul class="uk-nav uk-nav-default doc-nav">
        
          
          
          <li class=""><a href="/docs/TMPL/support/">Contacting support</a></li>
        
        </ul>
        

    </div>
</div>


    <div id="offcanvas" data-uk-offcanvas="flip: true; overlay: true">
    <div class="uk-offcanvas-bar">

        <a class="uk-logo uk-margin-small-bottom" href="/">Ledger Developer pages</a>
     
        <button class="uk-offcanvas-close" type="button" data-uk-close></button>
      
        <ul class="uk-nav uk-nav-primary uk-margin-top">
            
                

                

                
                    <li><a href="/" >Home</a></li>
                
            
                

                

                
                    <li><a href="/docs/TMPL/installation" >Docs</a></li>
                
            
                

                

                
                    <li><a href="/blog/" >Blog</a></li>
                
            
                

                

                
                    <li><a href="/changelog-timeline/" >Changelog</a></li>
                
            
                

                

                
                    <li><div class="uk-navbar-item"><a class="uk-button uk-button-success" href="/contact/" >Contact</a></div></li>
                
            
        </ul>

        <div class="uk-margin-top uk-text-center">
            <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex-center uk-grid">
                
<div class="uk-first-column">
    <a href="https://twitter.com/" data-uk-icon="icon: twitter" class="uk-icon-link uk-icon" target="_blank"></a>
</div>


<div>
    <a href="https://www.facebook.com/" data-uk-icon="icon: facebook" class="uk-icon-link uk-icon" target="_blank"></a>
</div>




<div>
    <a href="https://www.instagram.com/" data-uk-icon="icon: instagram" class="uk-icon-link uk-icon" target="_blank"></a>
</div>





<div>
    <a href="https://vimeo.com/" data-uk-icon="icon: vimeo" class="uk-icon-link uk-icon" target="_blank"></a>
</div>






            </div>
        </div>

    </div>
</div>


    
        <footer class="uk-section uk-text-center uk-text-muted">
    <div class="uk-container uk-container-small">

        <div>
            <ul class="uk-subnav uk-flex-center">
                
                    
                    
                    
                        <li><a href="/" >Home</a></li>
                    
                
                    
                    
                    
                        <li><a href="/blog/" >Blog</a></li>
                    
                
                    
                    
                    
                        <li><a href="/contact/" >Contact</a></li>
                    
                
            </ul>
        </div>
        <div class="uk-margin-medium">
            <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex-center uk-grid">
                
                
<div class="uk-first-column">
    <a href="https://twitter.com/" data-uk-icon="icon: twitter" class="uk-icon-link uk-icon" target="_blank"></a>
</div>


<div>
    <a href="https://www.facebook.com/" data-uk-icon="icon: facebook" class="uk-icon-link uk-icon" target="_blank"></a>
</div>




<div>
    <a href="https://www.instagram.com/" data-uk-icon="icon: instagram" class="uk-icon-link uk-icon" target="_blank"></a>
</div>





<div>
    <a href="https://vimeo.com/" data-uk-icon="icon: vimeo" class="uk-icon-link uk-icon" target="_blank"></a>
</div>






                
            </div>
        </div>
        <div class="uk-margin-medium uk-text-small copyright link-secondary">Made by <a href="https://ledger.com/">Ledger</a> France</div>

    </div>
</footer>

    

    

    

    </body>

</html>
